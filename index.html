<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Cole√ß√£o de Perfumes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #999;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
        }

        .card-title {
            color: #d4af37;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .card-description {
            color: #ccc;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .examples {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .examples-title {
            color: #d4af37;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .examples-list {
            color: #aaa;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .section-title {
            color: white;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            text-align: center;
        }

        .levels {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 30px;
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }

        .level-title {
            color: #d4af37;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .level-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 0.95em;
        }

        .level-item strong {
            color: #d4af37;
            display: block;
            margin-bottom: 5px;
        }

        .interactive-note {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            color: #9bc4ff;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
            border: 2px solid rgba(212, 175, 55, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-container:hover {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.25), rgba(212, 175, 55, 0.1));
            border-color: #d4af37;
            transform: translateX(5px);
        }

        .checkbox-container input {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #d4af37;
        }

        .checkbox-container label {
            cursor: pointer;
            flex: 1;
            color: #f4e5b1;
            font-weight: 600;
            font-size: 1.05em;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .balance-section {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .balance-title {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .balance-description {
            color: #ccc;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .family-counter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .counter-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .counter-item label {
            color: #d4af37;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .counter-item input {
            width: 100%;
            padding: 10px;
            font-size: 1.2em;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 5px;
            color: white;
        }

        .counter-item input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: 600;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .result-box {
            margin-top: 30px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
        }

        .result-title {
            color: #d4af37;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            color: white;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-advice {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-next {
            color: #9bc4ff;
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .result-next strong {
            color: #fff;
        }

        .context-section {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .context-title {
            color: #9bc4ff;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .context-item label {
            color: #9bc4ff;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .context-item input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="text"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .context-item input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="number"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
            cursor: pointer;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: rgba(100, 150, 255, 0.1);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MAPA DE COLE√á√ÉO PERFEITA</h1>
            <p class="subtitle">Monte sua cole√ß√£o sem redund√¢ncias e com fun√ß√£o real</p>
        </header>

        <h2 class="section-title">AS 6 FUN√á√ïES ESSENCIAIS</h2>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">üåû CALOR</div>
                <div class="card-description">
                    Perfume leve, fresco e que n√£o sufoca. Alta temperatura exige baixa densidade. Evite doces pesados e √¢mbares densos.
                </div>
                <div class="card-tags">
                    <span class="tag">C√≠trico</span>
                    <span class="tag">Aqu√°tico</span>
                    <span class="tag">Verde</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ C√≠trico + aqu√°tico<br>
                        ‚Ä¢ Verde fresco<br>
                        ‚Ä¢ Arom√°tico leve
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="calor">
                    <label for="calor">Tenho um perfume para calor</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ùÑÔ∏è FRIO</div>
                <div class="card-description">
                    Perfume denso, quente e envolvente. Baixa temperatura pede alta proje√ß√£o. Aqui entram os √¢mbares, especiarias e madeiras.
                </div>
                <div class="card-tags">
                    <span class="tag">√Çmbar</span>
                    <span class="tag">Madeira</span>
                    <span class="tag">Especiaria</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ √Çmbar + baunilha<br>
                        ‚Ä¢ Madeira seca + especiaria<br>
                        ‚Ä¢ Oriental denso
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="frio">
                    <label for="frio">Tenho um perfume para frio</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üíº TRABALHO</div>
                <div class="card-description">
                    Perfume discreto, profissional e sem polariza√ß√£o. M√©dio alcance, baixa do√ßura. Deve passar despercebido at√© ser notado de perto.
                </div>
                <div class="card-tags">
                    <span class="tag">Arom√°tico</span>
                    <span class="tag">Amadeirado seco</span>
                    <span class="tag">Fresco discreto</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Arom√°tico limpo<br>
                        ‚Ä¢ Amadeirado elegante<br>
                        ‚Ä¢ Fresco-seco balanceado
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="trabalho">
                    <label for="trabalho">Tenho um perfume para trabalho</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üåô NOITE</div>
                <div class="card-description">
                    Perfume marcante, de presen√ßa forte. Alta proje√ß√£o, notas intensas. Aqui voc√™ pode ousar: doces densos, especiarias, couro.
                </div>
                <div class="card-tags">
                    <span class="tag">Doce denso</span>
                    <span class="tag">Couro</span>
                    <span class="tag">Oriental intenso</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Doce + especiaria<br>
                        ‚Ä¢ Couro + fuma√ßa<br>
                        ‚Ä¢ √Çmbar + oud
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="noite">
                    <label for="noite">Tenho um perfume para noite</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚úçÔ∏è ASSINATURA</div>
                <div class="card-description">
                    Seu perfume identidade. O que te representa independente de contexto. Deve ser confort√°vel, vers√°til e voc√™ deve amar us√°-lo.
                </div>
                <div class="card-tags">
                    <span class="tag">Pessoal</span>
                    <span class="tag">Vers√°til</span>
                    <span class="tag">Confort√°vel</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Caracter√≠sticas:</div>
                    <div class="examples-list">
                        ‚Ä¢ Funciona em v√°rias situa√ß√µes<br>
                        ‚Ä¢ Voc√™ nunca cansa dele<br>
                        ‚Ä¢ As pessoas te associam a ele
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="assinatura">
                    <label for="assinatura">Tenho meu perfume assinatura</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üéä OCASI√ïES ESPECIAIS</div>
                <div class="card-description">
                    Perfume para momentos √∫nicos. Casamentos, festas, eventos importantes, anivers√°rios. Aquele que voc√™ reserva para ocasi√µes memor√°veis.
                </div>
                <div class="card-tags">
                    <span class="tag">Festivo</span>
                    <span class="tag">Marcante</span>
                    <span class="tag">Especial</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Ocasi√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Casamentos e formaturas<br>
                        ‚Ä¢ Festas e celebra√ß√µes<br>
                        ‚Ä¢ Jantares especiais e eventos
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="ocasioes">
                    <label for="ocasioes">Tenho perfume para ocasi√µes especiais</label>
                </div>
            </div>
        </div>

        <h2 class="section-title">üéØ DIAGN√ìSTICO AVAN√áADO: SUA COLE√á√ÉO EST√Å EQUILIBRADA?</h2>
        
        <div class="balance-section">
            <div class="balance-card">
                <div class="balance-title">Identifique sua fam√≠lia dominante</div>
                <div class="balance-description">
                    Conte quantos perfumes voc√™ tem de cada fam√≠lia. A fam√≠lia com mais perfumes √© sua dominante.
                </div>

                <div class="context-section">
                    <div class="context-title">üìç Contexto Pessoal</div>
                    <div style="
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 25px;
                    ">
                        <!-- COLUNA ESQUERDA: AMBIENTE + OR√áAMENTO -->
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="context-item">
                                <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üíº Ambiente de trabalho:</label>
                                <select id="ambiente" style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    font-size: 1em;
                                    background: rgba(0, 0, 0, 0.3);
                                    border: 2px solid rgba(100, 150, 255, 0.3);
                                    border-radius: 8px;
                                    color: white;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                " onfocus="this.style.borderColor='#9bc4ff'" onblur="this.style.borderColor='rgba(100, 150, 255, 0.3)'">
                                    <option value="" selected disabled>Selecione seu ambiente</option>
                                    <option value="fechado">Fechado (escrit√≥rio, loja)</option>
                                    <option value="aberto">Aberto (obra, rua, campo)</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                            
                            <div class="context-item">
                                <label for="orcamento" style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üí∞ Or√ßamento:</label>
                                <select id="orcamento" style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    font-size: 1em;
                                    background: rgba(0, 0, 0, 0.3);
                                    border: 2px solid rgba(100, 150, 255, 0.3);
                                    border-radius: 8px;
                                    color: white;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                " onfocus="this.style.borderColor='#9bc4ff'" onblur="this.style.borderColor='rgba(100, 150, 255, 0.3)'">
                                    <option value="" selected disabled>Selecione sua faixa</option>
                                    <option value="ate-350">At√© R$ 350</option>
                                    <option value="350-1500">R$ 350 - R$ 1.500</option>
                                    <option value="1500-2500">R$ 1.500 - R$ 2.500</option>
                                    <option value="sem-limite">Sem limite</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- COLUNA DIREITA: CLIMA -->
                        <div class="context-item">
                            <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üå°Ô∏è Clima da sua regi√£o:</label>
                            <input type="hidden" id="clima" value="temperado">
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button type="button" onclick="selecionarClima('quente', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(255, 100, 100, 0.1);
                                    border: 2px solid rgba(255, 100, 100, 0.3);
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">‚òÄÔ∏è</div>
                                    <div style="font-weight: 600;">Quente</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Norte, Nordeste</div>
                                </button>
                                
                                <button type="button" onclick="selecionarClima('temperado', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(212, 175, 55, 0.3);
                                    border: 2px solid #d4af37;
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">üå§Ô∏è</div>
                                    <div style="font-weight: 600;">Temperado</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sudeste</div>
                                </button>
                                
                                <button type="button" onclick="selecionarClima('frio', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(150, 200, 255, 0.1);
                                    border: 2px solid rgba(150, 200, 255, 0.3);
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">‚ùÑÔ∏è</div>
                                    <div style="font-weight: 600;">Frio</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sul</div>
                                </button>
                            </div>
                            
                            <style>
                                .clima-btn:hover {
                                    transform: translateY(-3px) scale(1.05);
                                    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
                                    border-color: #d4af37;
                                }
                                
                                .clima-btn.selected-quente {
                                    background: rgba(255, 100, 100, 0.3) !important;
                                    border-color: #ff6666 !important;
                                    box-shadow: 0 0 20px rgba(255, 100, 100, 0.6) !important;
                                }
                                
                                .clima-btn.selected-temperado {
                                    background: rgba(212, 175, 55, 0.3) !important;
                                    border-color: #d4af37 !important;
                                    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5) !important;
                                }
                                
                                .clima-btn.selected-frio {
                                    background: rgba(100, 150, 255, 0.3) !important;
                                    border-color: #6699ff !important;
                                    box-shadow: 0 0 20px rgba(100, 150, 255, 0.6) !important;
                                }
                            </style>
                        </div>
                    </div>
                    
                    <style>
                        @media (max-width: 768px) {
                            .context-section > div:nth-child(2) {
                                grid-template-columns: 1fr !important;
                            }
                        }
                    </style>
                </div>
                
                <div class="family-counter">
                    <div class="counter-item">
                        <label>üçã Fresco/C√≠trico</label>
                        <input type="number" id="fresco" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üåø Arom√°tico/Verde</label>
                        <input type="number" id="aromatico" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üçØ Doce/Gourmand</label>
                        <input type="number" id="doce" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>ü™µ Amadeirado</label>
                        <input type="number" id="amadeirado" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üî• Especiado/Oriental</label>
                        <input type="number" id="especiado" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üåä Aqu√°tico</label>
                        <input type="number" id="aquatico" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üßº Talco/Foug√®re</label>
                        <input type="number" id="talco" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üå∏ Floral</label>
                        <input type="number" id="floral" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üçì Frutas</label>
                        <input type="number" id="frutas" min="0" max="20" value="0">
                    </div>
                </div>

                <button class="analyze-btn" onclick="analyzeCollection()">ANALISAR COLE√á√ÉO</button>

                <div id="result" class="result-box" style="display: none;">
                    <div class="result-title">üìä RESULTADO DA AN√ÅLISE</div>
                    <div id="dominant-family" class="result-content"></div>
                    <div id="balance-advice" class="result-advice"></div>
                    <div id="next-purchase" class="result-next"></div>
                </div>
            </div>
        </div>

        <div class="interactive-note">
            <h3 style="margin-bottom: 15px;">üìã COMO USAR ESTE MAPA</h3>
            <p style="line-height: 1.8;">
                1. Marque as caixas dos perfumes que voc√™ J√Å TEM<br>
                2. Veja quais fun√ß√µes est√£o descobertas<br>
                3. Seu pr√≥ximo perfume deve preencher uma lacuna real<br>
                4. Se todas as fun√ß√µes est√£o cobertas, voc√™ n√£o precisa comprar nada novo
            </p>
        </div>
    </div>

    <script>
        // ===============================================
        // FUN√á√ÉO: SELECIONAR CLIMA
        // Precisa estar no in√≠cio para os bot√µes inline
        // ===============================================
        function selecionarClima(clima, btn) {
            // Remover todas as classes de sele√ß√£o
            document.querySelectorAll('.clima-btn').forEach(function(b) {
                b.classList.remove('selected-quente');
                b.classList.remove('selected-temperado');
                b.classList.remove('selected-frio');
            });
            
            // Adicionar classe espec√≠fica do clima
            btn.classList.add('selected-' + clima);
            
            // Atualizar valor do input hidden
            document.getElementById('clima').value = clima;
            
            // Salvar no localStorage
            localStorage.setItem('clima', clima);
            
            console.log('‚úÖ Clima selecionado:', clima);
        }

        // Salvar estado dos checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                localStorage.setItem(this.id, this.checked);
            });
            
            // Carregar estado salvo
            const saved = localStorage.getItem(checkbox.id);
            if (saved === 'true') {
                checkbox.checked = true;
            }
        });

        // Analisar cole√ß√£o com loading
        function analyzeCollection() {
            const families = {
                'fresco': { name: 'üçã Fresco/C√≠trico', value: parseInt(document.getElementById('fresco').value) || 0 },
                'aromatico': { name: 'üåø Arom√°tico/Verde', value: parseInt(document.getElementById('aromatico').value) || 0 },
                'doce': { name: 'üçØ Doce/Gourmand', value: parseInt(document.getElementById('doce').value) || 0 },
                'amadeirado': { name: 'ü™µ Amadeirado', value: parseInt(document.getElementById('amadeirado').value) || 0 },
                'especiado': { name: 'üî• Especiado/Oriental', value: parseInt(document.getElementById('especiado').value) || 0 },
                'aquatico': { name: 'üåä Aqu√°tico', value: parseInt(document.getElementById('aquatico').value) || 0 },
                'talco': { name: 'üßº Talco/Foug√®re', value: parseInt(document.getElementById('talco').value) || 0 },
                'floral': { name: 'üå∏ Floral', value: parseInt(document.getElementById('floral').value) || 0 },
                'frutas': { name: 'üçì Frutas', value: parseInt(document.getElementById('frutas').value) || 0 }
            };

            const total = Object.values(families).reduce((sum, f) => sum + f.value, 0);

            if (total === 0) {
                alert('Adicione pelo menos 1 perfume para analisar');
                return;
            }

            // MOSTRAR POPUP DE LOADING
            mostrarLoading();

            // Simular processamento por 2.5 segundos
            setTimeout(() => {
                fecharLoading();
                processarAnalise(families, total);
            }, 2500);
        }

        function mostrarLoading() {
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px 60px;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px; animation: spin 1.5s linear infinite;">
                        üîÑ
                    </div>
                    <div style="color: #d4af37; font-size: 1.8em; font-weight: 700; margin-bottom: 15px;">
                        Analisando sua cole√ß√£o...
                    </div>
                    <div style="color: #ccc; font-size: 1em; margin-bottom: 25px;">
                        Processando dados e identificando padr√µes
                    </div>
                    
                    <div style="
                        width: 300px;
                        height: 8px;
                        background: rgba(212, 175, 55, 0.2);
                        border-radius: 10px;
                        overflow: hidden;
                        margin: 0 auto;
                    ">
                        <div id="progress-bar" style="
                            width: 0%;
                            height: 100%;
                            background: linear-gradient(90deg, #d4af37, #f4e5b1);
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        "></div>
                    </div>
                </div>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            let progress = 0;
            const interval = setInterval(() => {
                progress += 4;
                const bar = document.getElementById('progress-bar');
                if (bar) bar.style.width = progress + '%';
                if (progress >= 100) clearInterval(interval);
            }, 100);
        }

        function fecharLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        // ============================
        // Integra√ß√£o com O Perfumista (iframe)
        // ============================
        function mostrarLoadingPerfumista() {
            if (document.getElementById('perfumista-loading-overlay')) return;

            const overlay = document.createElement('div');
            overlay.id = 'perfumista-loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.88);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 2px solid rgba(212, 175, 55, 0.9);
                    border-radius: 20px;
                    padding: 32px 28px;
                    max-width: 560px;
                    width: calc(100% - 40px);
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.25);
                    text-align: center;
                ">
                    <div style="color:#d4af37; font-size:2.2em; margin-bottom:10px;">ü§ñ</div>
                    <div style="color:#fff; font-size:1.35em; font-weight:900; margin-bottom:8px;">
                        Consultando o Perfumista...
                    </div>
                    <div style="color:#bbb; font-size:1em; line-height:1.5;">
                        Isso pode levar alguns segundos. N√£o feche a p√°gina.
                    </div>
                    <div style="margin-top:16px; height:10px; border-radius:999px; overflow:hidden; background: rgba(212,175,55,0.15);">
                        <div style="height:100%; width:40%; background: linear-gradient(90deg,#d4af37,#f4e5b1); animation: perfBar 1.1s infinite ease-in-out;"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);

            // injeta anima√ß√£o uma vez
            if (!document.getElementById('perfumista-loading-style')) {
                const style = document.createElement('style');
                style.id = 'perfumista-loading-style';
                style.innerHTML = `
                    @keyframes perfBar {
                        0% { transform: translateX(-60%); }
                        100% { transform: translateX(260%); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function fecharLoadingPerfumista() {
            const overlay = document.getElementById('perfumista-loading-overlay');
            if (!overlay) return;
            overlay.style.animation = 'fadeOut 0.25s ease';
            setTimeout(() => overlay.remove(), 250);
        }

        let perfumistaTimeout = null;

        function abrirPerfumistaNoMapa() {
            const panel = document.getElementById('perfumista-panel');
            const iframe = document.getElementById('perfumista-iframe');

            if (!panel || !iframe) {
                alert('N√£o encontrei o painel do Perfumista. Recarregue a p√°gina e gere o diagn√≥stico novamente.');
                return;
            }

            const diagnostico = (localStorage.getItem('diagnostico_completo') || '').trim();
            if (!diagnostico) {
                alert('N√£o achei o diagn√≥stico completo. Fa√ßa a an√°lise primeiro.');
                return;
            }

            panel.style.display = 'block';
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });

            mostrarLoadingPerfumista();

            // safety timeout (se o iframe n√£o avisar, fecha o popup depois)
            if (perfumistaTimeout) clearTimeout(perfumistaTimeout);
            perfumistaTimeout = setTimeout(() => {
                fecharLoadingPerfumista();
            }, 45000);

            const sendToIframe = () => {
                try {
                    iframe.contentWindow.postMessage(
                        { source: 'mapa', type: 'set_and_run', text: diagnostico },
                        'https://vguerise.github.io'
                    );
                } catch (e) {
                    // se falhar, pelo menos tira o loading para o usu√°rio n√£o ficar preso
                    fecharLoadingPerfumista();
                }
            };

            // Se j√° carregou, manda; sen√£o, manda no load
            try {
                // alguns browsers permitem postMessage mesmo antes do load, mas garantimos:
                iframe.addEventListener('load', () => sendToIframe(), { once: true });
                // tenta mandar j√°
                sendToIframe();
            } catch (e) {
                fecharLoadingPerfumista();
            }
        }

        function fecharPerfumistaNoMapa() {
            const panel = document.getElementById('perfumista-panel');
            if (panel) panel.style.display = 'none';
            fecharLoadingPerfumista();
        }

        // Recebe status do iframe (Perfumista)
        window.addEventListener('message', (event) => {
            if (event.origin !== 'https://vguerise.github.io') return;

            const data = event.data || {};
            if (data.source !== 'operfumista') return;

            // auto-ajuste de altura do iframe (evita scroll duplo)
            if (data.type === 'height' && data.height) {
                const iframe = document.getElementById('perfumista-iframe');
                if (iframe) iframe.style.height = (Number(data.height) + 20) + 'px';
                return;
            }

            if (data.type === 'loading') {
                mostrarLoadingPerfumista();
            }

            if (data.type === 'done' || data.type === 'error') {
                fecharLoadingPerfumista();
                if (perfumistaTimeout) clearTimeout(perfumistaTimeout);
            }
        });

        // exp√µe para o onclick do HTML
        window.abrirPerfumistaNoMapa = abrirPerfumistaNoMapa;
        window.fecharPerfumistaNoMapa = fecharPerfumistaNoMapa;



        function processarAnalise(families, total) {
            // Pegar contexto pessoal
            const climaRegiao = document.getElementById('clima').value || 'temperado';
            const orcamento = document.getElementById('orcamento').value;
            const ambiente = document.getElementById('ambiente').value;

            // Contar fam√≠lias representadas
            const familiesRepresented = Object.values(families).filter(f => f.value > 0).length;

            // Encontrar fam√≠lia dominante
            let dominant = null;
            let maxValue = 0;
            Object.entries(families).forEach(([key, data]) => {
                if (data.value > maxValue) {
                    maxValue = data.value;
                    dominant = { key, ...data };
                }
            });

            const percentage = ((maxValue / total) * 100).toFixed(0);

            // CALCULAR N√çVEL DO COLECIONADOR
            let level = '';
            let levelEmoji = '';
            let levelAdvice = '';

            if (total >= 1 && total <= 5) {
                levelEmoji = 'üéØ';
                level = 'INICIANTE';
                levelAdvice = 'Voc√™ est√° come√ßando. Foque nas 5 fun√ß√µes b√°sicas (calor, frio, trabalho, noite, assinatura) antes de diversificar.';
            } else if (total >= 6 && total <= 10) {
                if (familiesRepresented >= 4 && percentage < 50) {
                    levelEmoji = '‚ö°';
                    level = 'INTERMEDI√ÅRIO';
                    levelAdvice = 'Cole√ß√£o crescendo bem. Continue diversificando e evite redund√¢ncias na fam√≠lia dominante.';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'INTERMEDI√ÅRIO (com desequil√≠brio)';
                    levelAdvice = 'Voc√™ tem quantidade de intermedi√°rio, mas est√° comprando muito da mesma fam√≠lia. Diversifique antes de expandir.';
                }
            } else if (total >= 11 && total <= 15) {
                if (familiesRepresented >= 5 && percentage <= 40) {
                    levelEmoji = 'üî•';
                    level = 'AVAN√áADO';
                    levelAdvice = 'Cole√ß√£o madura e equilibrada. Cada novo perfume deve preencher uma subfun√ß√£o espec√≠fica (ex: calor extremo, trabalho formal).';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'AVAN√áADO (com redund√¢ncia)';
                    levelAdvice = 'Voc√™ tem muitos perfumes, mas com sobreposi√ß√£o. Identifique os redundantes e considere vender/trocar antes de comprar mais.';
                }
            } else {
                if (percentage <= 35 && familiesRepresented >= 5) {
                    levelEmoji = 'üëë';
                    level = 'COLECIONADOR EQUILIBRADO';
                    levelAdvice = 'Cole√ß√£o extensa e diversificada. Agora o foco √©: cada perfume tem fun√ß√£o clara ou voc√™ est√° acumulando?';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'COLECIONADOR (com ac√∫mulo)';
                    levelAdvice = 'Voc√™ tem MUITOS perfumes, mas est√° acumulando redund√¢ncias. Pare de comprar. Venda os que n√£o usa e reorganize.';
                }
            }

            // Encontrar fam√≠lias ausentes ou fracas
            const missing = Object.entries(families)
                .filter(([key, data]) => data.value === 0)
                .map(([key, data]) => ({ key, ...data }));
            
            const weak = Object.entries(families)
                .filter(([key, data]) => data.value === 1)
                .map(([key, data]) => ({ key, ...data }));

            // Gerar an√°lise
            const resultDiv = document.getElementById('result');
            const dominantDiv = document.getElementById('dominant-family');
            const adviceDiv = document.getElementById('balance-advice');
            const nextDiv = document.getElementById('next-purchase');

            // Criar layout gr√°fico compacto para as informa√ß√µes
            const climaLabel = climaRegiao === 'quente' ? 'üå°Ô∏è Clima quente' : climaRegiao === 'frio' ? '‚ùÑÔ∏è Clima frio' : 'üå§Ô∏è Clima temperado';
            const ambienteLabel = ambiente === 'fechado' ? 'Fechado' : ambiente === 'aberto' ? 'Aberto' : ambiente === 'ambos' ? 'Ambos' : 'N√£o informado';
            
            const infoCards = `
                <div style="
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 12px;
                    margin-bottom: 20px;
                ">
                    ${climaRegiao ? `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.4);
                            border-radius: 8px;
                            padding: 12px;
                        ">
                            <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üå°Ô∏è CLIMA</div>
                            <div style="color: #fff; font-size: 0.95em; line-height: 1.5;">
                                <span style="color: #9bc4ff;">${climaLabel}</span>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${ambiente ? `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.4);
                            border-radius: 8px;
                            padding: 12px;
                        ">
                            <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üíº AMBIENTE</div>
                            <div style="color: #fff; font-size: 0.95em;">
                                ${ambienteLabel}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border: 2px solid rgba(212, 175, 55, 0.4);
                        border-radius: 8px;
                        padding: 12px;
                    ">
                        <div style="font-size: 0.85em; color: #d4af37; margin-bottom: 6px; font-weight: 600;">üìä TOTAL</div>
                        <div style="color: #fff; font-size: 1.3em; font-weight: 700;">${total} perfumes</div>
                    </div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border: 2px solid rgba(212, 175, 55, 0.4);
                        border-radius: 8px;
                        padding: 12px;
                    ">
                        <div style="font-size: 0.85em; color: #d4af37; margin-bottom: 6px; font-weight: 600;">üéØ FAM√çLIAS</div>
                        <div style="color: #fff; font-size: 1.3em; font-weight: 700;">${familiesRepresented}/9</div>
                    </div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                        border: 3px solid #d4af37;
                        border-radius: 8px;
                        padding: 12px;
                        grid-column: 1 / -1;
                    ">
                        <div style="font-size: 0.85em; color: #d4af37; margin-bottom: 8px; font-weight: 600;">üëë FAM√çLIA DOMINANTE</div>
                        <div style="color: #fff; font-size: 1.2em; font-weight: 700; margin-bottom: 4px;">
                            ${dominant.name}
                        </div>
                        <div style="color: #f4e5b1; font-size: 1em;">
                            ${maxValue} perfumes ¬∑ <strong style="color: #d4af37; font-size: 1.15em;">${percentage}%</strong> da cole√ß√£o
                        </div>
                    </div>
                </div>
                
                <style>
                    @media (max-width: 768px) {
                        #dominant-family > div:first-child {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            `;

            dominantDiv.innerHTML = `
                <div style="background: rgba(212, 175, 55, 0.15); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #d4af37;">
                    <div style="font-size: 1.3em; margin-bottom: 10px;">${levelEmoji} <strong>SEU N√çVEL: ${level}</strong></div>
                    <div style="color: #ccc; font-size: 0.95em;">${levelAdvice}</div>
                </div>
                ${infoCards}
            `;

            // An√°lise e conselhos
            let advice = '';
            let status = '';

            if (percentage >= 50) {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(255, 50, 50, 0.3), rgba(200, 0, 0, 0.2));
                        border: 4px solid #ff3333;
                        border-radius: 12px;
                        padding: 25px;
                        margin-bottom: 20px;
                        box-shadow: 0 0 30px rgba(255, 50, 50, 0.5);
                        animation: pulse-red 2s infinite;
                    ">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üö®</div>
                        <div style="font-size: 1.5em; font-weight: 700; color: #ff6666; text-align: center; text-transform: uppercase;">
                            ATEN√á√ÉO: COLE√á√ÉO DESBALANCEADA!
                        </div>
                    </div>
                    <style>
                        @keyframes pulse-red {
                            0%, 100% { box-shadow: 0 0 30px rgba(255, 50, 50, 0.5); }
                            50% { box-shadow: 0 0 50px rgba(255, 50, 50, 0.8); }
                        }
                    </style>
                `;
                advice = `
                    <div style="font-size: 1.25em; line-height: 1.8; margin-top: 15px;">
                        <div style="text-align: center;">
                            <strong style="color: #ff6666; font-size: 1.4em;">VOC√ä EST√Å DESPERDI√áANDO DINHEIRO!</strong>
                        </div>
                        <br>
                        <span style="font-size: 1.15em; color: #fff;">
                            Voc√™ est√° viciado em <strong style="color: #d4af37;">${dominant.name}</strong>. 
                            Isso cria <strong style="color: #ff6666;">redund√¢ncia cr√≠tica</strong> ‚Äî voc√™ tem v√°rios perfumes fazendo a MESMA fun√ß√£o.
                        </span>
                        <br><br>
                        <strong style="color: #ffaa00; font-size: 1.15em;">üí∏ Resultado:</strong> 
                        <span style="font-size: 1.1em;">
                            Voc√™ gasta mais, usa menos, e n√£o tem op√ß√µes reais para diferentes situa√ß√µes.
                        </span>
                    </div>
                `;
            } else if (percentage >= 35) {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(255, 165, 0, 0.3), rgba(255, 140, 0, 0.2));
                        border: 4px solid #ff9933;
                        border-radius: 12px;
                        padding: 25px;
                        margin-bottom: 20px;
                        box-shadow: 0 0 30px rgba(255, 165, 0, 0.5);
                        animation: pulse-orange 2.5s infinite;
                    ">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">‚ö†Ô∏è</div>
                        <div style="font-size: 1.4em; font-weight: 700; color: #ffaa00; text-align: center; text-transform: uppercase;">
                            Alerta: Cole√ß√£o com Vi√©s!
                        </div>
                    </div>
                    <style>
                        @keyframes pulse-orange {
                            0%, 100% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.5); }
                            50% { box-shadow: 0 0 45px rgba(255, 165, 0, 0.7); }
                        }
                    </style>
                `;
                advice = `
                    <div style="font-size: 1.25em; line-height: 1.8; margin-top: 15px;">
                        <div style="text-align: center;">
                            <strong style="color: #ffaa00; font-size: 1.3em;">SUA COLE√á√ÉO EST√Å DESEQUILIBRADA!</strong>
                        </div>
                        <br>
                        <span style="font-size: 1.15em; color: #fff;">
                            <strong style="color: #d4af37;">${dominant.name}</strong> domina sua cole√ß√£o (<strong style="color: #ffaa00; font-size: 1.2em;">${percentage}%</strong>). 
                            Voc√™ est√° comprando sempre o mesmo tipo de perfume.
                        </span>
                        <br><br>
                        <strong style="color: #ffcc66; font-size: 1.15em;">‚ö†Ô∏è Aten√ß√£o:</strong> 
                        <span style="font-size: 1.1em;">
                            Seu pr√≥ximo perfume <strong style="color: #ff6666;">N√ÉO</strong> deve ser dessa fam√≠lia. 
                            Voc√™ precisa diversificar <strong style="color: #ffaa00;">AGORA!</strong>
                        </span>
                    </div>
                `;
            } else {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
                        border: 3px solid rgba(76, 175, 80, 0.5);
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 20px;
                        text-align: center;
                    ">
                        <div style="font-size: 1.8em; margin-bottom: 8px;">‚úÖ</div>
                        <div style="font-size: 1.3em; font-weight: 700; color: #81c784;">
                            COLE√á√ÉO EQUILIBRADA
                        </div>
                    </div>
                `;
                advice = `Sua cole√ß√£o tem boa distribui√ß√£o entre fam√≠lias. Voc√™ tem op√ß√µes reais para diferentes contextos. Continue expandindo as fam√≠lias mais fracas antes de adicionar mais na dominante.`;
            }

            adviceDiv.innerHTML = status + advice;

            // RECOMENDA√á√ïES PERSONALIZADAS BASEADAS EM FAM√çLIAS FALTANTES
            let nextPurchase = '';
            
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += `
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border: 2px solid rgba(212, 175, 55, 0.3);
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 20px;
                    ">
                        <div style="
                            font-size: 1.2em;
                            font-weight: 700;
                            color: #d4af37;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        ">
                            <span style="font-size: 1.5em;">üéØ</span>
                            <span>FAM√çLIAS QUE FALTAM</span>
                        </div>
                        
                        <div style="display: grid; gap: 12px;">
                `;
                
                // Cards compactos para cada fam√≠lia
                [...missing, ...weak].forEach(family => {
                    let icon, description, examples;
                    
                    if (family.key === 'fresco') {
                        icon = 'üçã';
                        description = 'Calor e ver√£o ¬∑ Trabalho aberto ¬∑ P√≥s-treino';
                        examples = 'C√≠tricos, √°gua de col√¥nia, bergamota';
                    } else if (family.key === 'aromatico') {
                        icon = 'üåø';
                        description = 'Vers√°til profissional ¬∑ Reuni√µes ¬∑ Uso di√°rio';
                        examples = 'Lavanda, s√°lvia, foug√®re';
                    } else if (family.key === 'doce') {
                        icon = 'üçØ';
                        description = 'Noite ¬∑ Encontros ¬∑ Frio ¬∑ Eventos';
                        examples = 'Baunilha, caramelo, tabaco doce';
                    } else if (family.key === 'amadeirado') {
                        icon = 'ü™µ';
                        description = 'Elegante formal ¬∑ Outono/inverno ¬∑ Cl√°ssico';
                        examples = 'S√¢ndalo, cedro, madeira nobre';
                    } else if (family.key === 'especiado') {
                        icon = 'üî•';
                        description = 'Frio intenso ¬∑ Noite ¬∑ Impacto';
                        examples = 'Canela, pimenta, incenso';
                    } else if (family.key === 'aquatico') {
                        icon = 'üåä';
                        description = 'Calor extremo ¬∑ Praia ¬∑ Esportes';
                        examples = '√Ågua marinha, oz√¥nico, mel√£o';
                    } else if (family.key === 'talco') {
                        icon = 'üßº';
                        description = 'Clean profissional ¬∑ P√≥s-barba ¬∑ Cl√°ssico';
                        examples = 'Talco, barbeiro, foug√®re tradicional';
                    } else if (family.key === 'frutas') {
                        icon = 'üçì';
                        description = 'Casual ¬∑ Jovem ¬∑ Climas quentes ¬∑ Uso diurno';
                        examples = 'Ma√ß√£, pera, frutas vermelhas, manga';
                    } else if (family.key === 'floral') {
                        icon = 'üå∏';
                        description = 'Elegante ¬∑ Rom√¢ntico ¬∑ Ambientes fechados ¬∑ Dia a dia';
                        examples = 'Rosa, jasmim, flor de laranjeira, √≠ris';
                    }

                    
                    nextPurchase += `
                        <div style="
                            background: rgba(0, 0, 0, 0.3);
                            border-left: 4px solid #d4af37;
                            padding: 12px 15px;
                            border-radius: 8px;
                            display: grid;
                            gap: 6px;
                        ">
                            <div style="
                                font-size: 1.1em;
                                font-weight: 700;
                                color: #fff;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                            ">
                                <span style="font-size: 1.3em;">${icon}</span>
                                <span>${family.name}</span>
                            </div>
                            <div style="color: #bbb; font-size: 0.95em;">
                                ${description}
                            </div>
                            <div style="color: #888; font-size: 0.85em; font-style: italic;">
                                Ex: ${examples}
                            </div>
                        </div>
                    `;
                });
                
                nextPurchase += `
                        </div>
                    </div>
                `;

                // Card de clima
                if (climaRegiao) {
                    let climaIcon, climaTitle, climaMessage, climaColor;
                    
                    if (climaRegiao === 'quente') {
                        climaIcon = 'üå°Ô∏è';
                        climaTitle = 'REGI√ÉO QUENTE';
                        climaColor = '#ff6b35';
                        if (families.fresco.value === 0 || families.aquatico.value === 0) {
                            climaMessage = '<strong>PRIORIDADE M√ÅXIMA:</strong> Frescos/Aqu√°ticos s√£o essenciais. Sem eles, voc√™ vai sofrer no calor.';
                        } else {
                            climaMessage = '‚úÖ Voc√™ tem op√ß√µes para o calor. Mantenha essas fam√≠lias leves na rota√ß√£o.';
                        }
                    } else if (climaRegiao === 'frio') {
                        climaIcon = '‚ùÑÔ∏è';
                        climaTitle = 'REGI√ÉO FRIA';
                        climaColor = '#4a90e2';
                        if (families.doce.value === 0 || families.especiado.value === 0) {
                            climaMessage = '<strong>URGENTE:</strong> Doces e Especiados s√£o essenciais. Frescos v√£o desaparecer no frio.';
                        } else {
                            climaMessage = '‚úÖ Voc√™ tem op√ß√µes para o frio. Aproveite os densos e especiados.';
                        }
                    } else {
                        climaIcon = 'üå§Ô∏è';
                        climaTitle = 'CLIMA TEMPERADO';
                        climaColor = '#f4a460';
                        climaMessage = 'Clima vers√°til exige op√ß√µes para ambas as esta√ß√µes. Mantenha variedade.';
                    }
                    
                    nextPurchase += `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.3);
                            border-radius: 12px;
                            padding: 16px 20px;
                            margin-bottom: 20px;
                        ">
                            <div style="
                                font-size: 1.1em;
                                font-weight: 700;
                                color: ${climaColor};
                                margin-bottom: 10px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                            ">
                                <span style="font-size: 1.4em;">${climaIcon}</span>
                                <span>${climaTitle}</span>
                            </div>
                            <div style="color: #ccc; font-size: 0.95em; line-height: 1.6;">
                                ${climaMessage}
                            </div>
                        </div>
                    `;
                }

                // Card de ambiente de trabalho
                if (ambiente) {
                    let ambIcon = 'üíº';
                    let ambTitle = 'AMBIENTE DE TRABALHO';
                    let ambMessage = '';
                    
                    if (ambiente === 'fechado' || ambiente === 'ambos') {
                        if (families.aromatico.value === 0) {
                            ambMessage = 'üè¢ <strong>Ambiente fechado exige discretos!</strong> Arom√°tico/Verde √© ESSENCIAL para n√£o incomodar. Evite doces densos no escrit√≥rio.';
                        } else {
                            ambMessage = '‚úÖ Voc√™ tem arom√°ticos para o ambiente fechado. Perfeito para n√£o incomodar colegas.';
                        }
                    } else if (ambiente === 'aberto') {
                        ambMessage = 'üå≥ Ambiente aberto permite mais liberdade. Frescos e aqu√°ticos s√£o ideais para o ar livre.';
                    }
                    
                    if (ambMessage) {
                        nextPurchase += `
                            <div style="
                                background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                                border: 2px solid rgba(100, 150, 255, 0.3);
                                border-radius: 12px;
                                padding: 16px 20px;
                                margin-bottom: 20px;
                            ">
                                <div style="
                                    font-size: 1.1em;
                                    font-weight: 700;
                                    color: #9bc4ff;
                                    margin-bottom: 10px;
                                    display: flex;
                                    align-items: center;
                                    gap: 10px;
                                ">
                                    <span style="font-size: 1.4em;">${ambIcon}</span>
                                    <span>${ambTitle}</span>
                                </div>
                                <div style="color: #ccc; font-size: 0.95em; line-height: 1.6;">
                                    ${ambMessage}
                                </div>
                            </div>
                        `;
                    }
                }
                
            } else {
                nextPurchase += 'Todas as fam√≠lias est√£o representadas. Escolha baseado em <strong>fun√ß√£o</strong> (calor, frio, trabalho, noite) que esteja faltando.';
            }

            // Pr√≥ximos passos baseados no n√≠vel
            if (level.includes('INICIANTE')) {
                nextPurchase += `<br>üéØ <strong>PR√ìXIMO PASSO:</strong> Complete as 5 fun√ß√µes b√°sicas antes de pensar em variedade de fam√≠lias.`;
            } else if (level.includes('redund√¢ncia') || level.includes('ac√∫mulo')) {
                nextPurchase += `<br>üõë <strong>PARE DE COMPRAR.</strong> Identifique perfumes redundantes, venda ou troque, e s√≥ compre quando identificar uma lacuna funcional real.`;
            }

            // Regra de ouro
            nextPurchase += `<br><br>üéØ <strong>REGRA DE OURO:</strong> Se voc√™ n√£o consegue pensar em 3 situa√ß√µes espec√≠ficas onde usaria o perfume que est√° pensando em comprar, voc√™ N√ÉO precisa dele.`;

            // SISTEMA DE RECOMENDA√á√ÉO DE 3 PERFUMES ESPEC√çFICOS
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += `<br><br><div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.05)); padding: 20px; border-radius: 10px; border: 2px solid #d4af37;">`;
                nextPurchase += `<div style="font-size: 1.2em; color: #d4af37; font-weight: 600; margin-bottom: 15px; text-align: center;">üéÅ 3 RECOMENDA√á√ïES PARA EQUILIBRAR SUA COLE√á√ÉO</div>`;
                nextPurchase += `<div style="color: #aaa; text-align: center; margin-bottom: 20px; font-size: 0.9em;">Baseado no seu clima, or√ßamento e lacunas identificadas</div>`;
                
                // Base de dados de perfumes por fam√≠lia e faixa de pre√ßo
                const perfumeDatabase = {
                    fresco: {
                        economico: [
                            { nome: "√Ågua de Cheiro Acqua Fresca", preco: "80-120", desc: "Nacional fresco c√≠trico para calor intenso" },
                            { nome: "Eudora Soul Fresh", preco: "100-150", desc: "Nacional aqu√°tico clean, dia a dia" },
                            { nome: "Lattitude Inspire (inspirado Invictus)", preco: "150-250", desc: "Inspirado fresco marinho, √≥tima performance" },
                            { nome: "Cheiro de Banho Brisas do Atl√¢ntico", preco: "120-180", desc: "Nacional aqu√°tico fresco, alta fixa√ß√£o" }
                        ],
                        intermediario: [
                            { nome: "Versace Pour Homme", preco: "280-380", desc: "C√≠trico elegante com notas aqu√°ticas" },
                            { nome: "Dolce & Gabbana Light Blue", preco: "350-480", desc: "C√≠trico sofisticado, muito vers√°til" },
                            { nome: "Acqua di Gi√≤ Profumo", preco: "400-550", desc: "Aqu√°tico denso, funciona ano todo" },
                            { nome: "Prada Luna Rossa Ocean", preco: "380-520", desc: "Aqu√°tico arom√°tico moderno" }
                        ],
                        premium: [
                            { nome: "Creed Aventus Cologne", preco: "1600-2200", desc: "Nicho fresco premium com performance excepcional" },
                            { nome: "Tom Ford Neroli Portofino", preco: "1800-2400", desc: "Nicho c√≠trico luxuoso, assinatura de ver√£o" },
                            { nome: "Parfums de Marly Percival", preco: "1500-2000", desc: "Nicho fresco amadeirado de alta qualidade" },
                            { nome: "Creed Silver Mountain Water", preco: "1600-2100", desc: "Nicho arom√°tico verde premium" }
                        ]
                    },
                    aromatico: {
                        economico: [
                            { nome: "Natura Homem Essence", preco: "120-180", desc: "Nacional arom√°tico discreto para trabalho" },
                            { nome: "O Botic√°rio Malbec Bleu", preco: "150-220", desc: "Nacional arom√°tico elegante, profissional" },
                            { nome: "Lattitude Route (inspirado Sauvage)", preco: "180-280", desc: "Inspirado arom√°tico pimenta, vers√°til" },
                            { nome: "Paris Elysees La Vie Est Belle Homme", preco: "100-150", desc: "Nacional arom√°tico limpo para dia a dia" }
                        ],
                        intermediario: [
                            { nome: "Dior Sauvage EDT", preco: "380-520", desc: "Arom√°tico pimenta, extremamente vers√°til" },
                            { nome: "Bleu de Chanel EDT", preco: "420-580", desc: "Arom√°tico c√≠trico sofisticado" },
                            { nome: "Prada L'Homme", preco: "350-480", desc: "Arom√°tico √≠ris clean para trabalho" },
                            { nome: "Versace Dylan Blue", preco: "300-420", desc: "Arom√°tico aqu√°tico moderno" }
                        ],
                        premium: [
                            { nome: "Tom Ford Grey Vetiver", preco: "1600-2200", desc: "Nicho arom√°tico elegante para trabalho formal" },
                            { nome: "Herm√®s Terre d'Herm√®s", preco: "1500-2000", desc: "Nicho arom√°tico c√≠trico atemporal" },
                            { nome: "Creed Green Irish Tweed", preco: "1700-2300", desc: "Nicho arom√°tico verde cl√°ssico" },
                            { nome: "Tom Ford Vert Boh√®me", preco: "2200-2800", desc: "Nicho arom√°tico verde premium" }
                        ]
                    },
                    doce: {
                        economico: [
                            { nome: "O Botic√°rio Malbec", preco: "120-180", desc: "Nacional doce amadeirado para noite" },
                            { nome: "Ferrari Black", preco: "150-220", desc: "Nacional doce especiado intenso" },
                            { nome: "Mahogany Leather Red (inspirado 1 Million)", preco: "180-280", desc: "Inspirado doce especiado noturno" },
                            { nome: "Afnan 9PM", preco: "200-320", desc: "√Årabe doce para noites frias, alta proje√ß√£o" }
                        ],
                        intermediario: [
                            { nome: "Paco Rabanne 1 Million", preco: "350-480", desc: "Doce especiado para noite" },
                            { nome: "Viktor & Rolf Spicebomb", preco: "400-550", desc: "Doce especiado intenso para frio" },
                            { nome: "Yves Saint Laurent La Nuit de L'Homme", preco: "380-520", desc: "Doce cardamomo elegante" },
                            { nome: "Jean Paul Gaultier Le Male Le Parfum", preco: "420-580", desc: "Doce oriental denso" }
                        ],
                        premium: [
                            { nome: "Initio Oud for Greatness", preco: "1800-2400", desc: "Nicho doce oud poderoso, presen√ßa m√°xima" },
                            { nome: "Parfums de Marly Layton", preco: "1600-2200", desc: "Nicho doce especiado de luxo" },
                            { nome: "Xerjoff Naxos", preco: "1700-2300", desc: "Nicho doce tabaco mel premium" },
                            { nome: "Tom Ford Tobacco Vanille", preco: "1800-2500", desc: "Nicho especiado tabaco baunilha ic√¥nico" }
                        ]
                    },
                    amadeirado: {
                        economico: [
                            { nome: "Natura Kaiak Tradicional", preco: "80-130", desc: "Nacional amadeirado cl√°ssico vers√°til" },
                            { nome: "O Botic√°rio Coffee Man", preco: "120-180", desc: "Nacional amadeirado caf√© elegante" },
                            { nome: "Lattitude Legend (inspirado Montblanc Legend)", preco: "180-280", desc: "Inspirado amadeirado discreto profissional" },
                            { nome: "Club de Nuit Intense Man", preco: "250-350", desc: "√Årabe amadeirado frutal (tipo Aventus)" }
                        ],
                        intermediario: [
                            { nome: "Bleu de Chanel Parfum", preco: "550-750", desc: "Amadeirado denso, assinatura premium" },
                            { nome: "Givenchy Gentleman EDP", preco: "400-550", desc: "Amadeirado √≠ris couro elegante" },
                            { nome: "Dior Homme Intense", preco: "450-600", desc: "Amadeirado √≠ris sofisticado" },
                            { nome: "Prada L'Homme Intense", preco: "380-520", desc: "Amadeirado √¢mbar discreto" }
                        ],
                        premium: [
                            { nome: "Creed Aventus", preco: "1800-2500", desc: "Nicho amadeirado frutal ic√¥nico" },
                            { nome: "Tom Ford Oud Wood", preco: "1800-2400", desc: "Nicho amadeirado oud acess√≠vel e elegante" },
                            { nome: "Parfums de Marly Herod", preco: "1600-2200", desc: "Nicho amadeirado tabaco canela premium" },
                            { nome: "Roja Dove Elysium", preco: "2200-3000", desc: "Nicho amadeirado c√≠trico de luxo absoluto" }
                        ]
                    },
                    especiado: {
                        economico: [
                            { nome: "Jequiti Make B. Boticollection", preco: "100-150", desc: "Nacional especiado doce para noite" },
                            { nome: "Eudora Glamour Secrets Black", preco: "120-180", desc: "Nacional especiado intenso noturno" },
                            { nome: "Rasasi La Yuqawam", preco: "200-320", desc: "√Årabe especiado tabaco para frio extremo" },
                            { nome: "Armaf Club de Nuit Intense", preco: "180-280", desc: "√Årabe especiado amadeirado potente" }
                        ],
                        intermediario: [
                            { nome: "Armani Code Profumo", preco: "400-550", desc: "Especiado doce para noites frias" },
                            { nome: "Dior Homme Parfum", preco: "500-700", desc: "Especiado √≠ris couro denso" },
                            { nome: "Azzaro Wanted by Night", preco: "350-480", desc: "Especiado canela intenso" },
                            { nome: "Giorgio Armani Stronger With You Intensely", preco: "380-520", desc: "Especiado doce moderno" }
                        ],
                        premium: [
                            { nome: "Initio Side Effect", preco: "1800-2400", desc: "Nicho especiado tabaco rum premium" },
                            { nome: "Parfums de Marly Oajan", preco: "1700-2300", desc: "Nicho especiado canela mel de luxo" },
                            { nome: "Amouage Interlude Man", preco: "1600-2200", desc: "Nicho especiado incenso complexo" },
                            { nome: "Roja Dove Enigma", preco: "2500-3500", desc: "Nicho especiado oriental absoluto" }
                        ]
                    },
                    aquatico: {
                        economico: [
                            { nome: "Natura Homem Verano", preco: "100-150", desc: "Nacional aqu√°tico para calor intenso" },
                            { nome: "Jequiti Oceano Atlantis", preco: "80-130", desc: "Nacional aqu√°tico fresco praia" },
                            { nome: "Paris Elysees Vodka Man", preco: "100-150", desc: "Nacional aqu√°tico clean para ver√£o" },
                            { nome: "Davidoff Cool Water", preco: "180-280", desc: "Aqu√°tico cl√°ssico para calor" }
                        ],
                        intermediario: [
                            { nome: "Acqua di Gi√≤ Profondo", preco: "400-550", desc: "Aqu√°tico marinho moderno" },
                            { nome: "Chanel Allure Homme Sport Eau Extr√™me", preco: "480-650", desc: "Aqu√°tico fresco esportivo premium" },
                            { nome: "Issey Miyake L'Eau d'Issey Pour Homme", preco: "350-480", desc: "Aqu√°tico yuzu elegante" },
                            { nome: "Bvlgari Aqva Pour Homme", preco: "380-520", desc: "Aqu√°tico marinho sofisticado" }
                        ],
                        premium: [
                            { nome: "Creed Virgin Island Water", preco: "1700-2300", desc: "Nicho aqu√°tico tropical premium" },
                            { nome: "Parfums de Marly Sedley", preco: "1600-2200", desc: "Nicho aqu√°tico bergamota elegante" },
                            { nome: "Acqua di Parma Blu Mediterraneo", preco: "1500-2000", desc: "Nicho aqu√°tico italiano luxuoso" },
                            { nome: "Creed Mill√©sime Imp√©rial", preco: "1800-2400", desc: "Nicho aqu√°tico frutal ic√¥nico" }
                        ]
                    }
                };

                // Determinar faixa de or√ßamento baseado na sele√ß√£o
                let faixaOrcamento = 'intermediario'; // Padr√£o
                
                if (orcamento === 'ate-350') {
                    faixaOrcamento = 'economico';
                } else if (orcamento === '350-1500') {
                    faixaOrcamento = 'intermediario';
                } else if (orcamento === '1500-2500' || orcamento === 'sem-limite') {
                    faixaOrcamento = 'premium';
                }

                // Priorizar fam√≠lias baseado em contexto
                let prioridades = [...missing, ...weak];
                
                // Ajustar prioridades baseado em clima
                if (climaRegiao === 'quente') {
                    prioridades = prioridades.sort((a, b) => {
                        const ordemCalor = ['fresco', 'aquatico', 'aromatico', 'amadeirado', 'doce', 'especiado'];
                        return ordemCalor.indexOf(a.key) - ordemCalor.indexOf(b.key);
                    });
                } else if (climaRegiao === 'frio') {
                    prioridades = prioridades.sort((a, b) => {
                        const ordemFrio = ['especiado', 'doce', 'amadeirado', 'aromatico', 'fresco', 'aquatico'];
                        return ordemFrio.indexOf(a.key) - ordemFrio.indexOf(b.key);
                    });
                }

                // Ajustar prioridades baseado em ambiente de trabalho
                if ((ambiente === 'fechado' || ambiente === 'ambos') && prioridades.some(p => p.key === 'aromatico')) {
                    prioridades = prioridades.sort((a, b) => {
                        if (a.key === 'aromatico') return -1;
                        if (b.key === 'aromatico') return 1;
                        return 0;
                    });
                }

                // Gerar 3 recomenda√ß√µes
                let recomendacoes = [];
                let familiasUsadas = new Set();

                for (let i = 0; i < Math.min(3, prioridades.length); i++) {
                    const familia = prioridades[i];
                    if (perfumeDatabase[familia.key] && !familiasUsadas.has(familia.key)) {
                        const opcoes = perfumeDatabase[familia.key][faixaOrcamento];
                        const perfume = opcoes[Math.floor(Math.random() * opcoes.length)];
                        recomendacoes.push({
                            familia: familia.name,
                            ...perfume,
                            prioridade: i + 1
                        });
                        familiasUsadas.add(familia.key);
                    }
                }

                // Exibir recomenda√ß√µes
                recomendacoes.forEach((rec, index) => {
                    let numeroBG = index === 0 ? '#d4af37' : index === 1 ? '#c4a037' : '#b49037';
                    nextPurchase += `
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid ${numeroBG};">
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: ${numeroBG}; color: #000; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2em; flex-shrink: 0;">
                                    ${rec.prioridade}
                                </div>
                                <div style="flex: 1;">
                                    <div style="color: #d4af37; font-size: 1.1em; font-weight: 600; margin-bottom: 5px;">
                                        ${rec.nome}
                                    </div>
                                    <div style="color: #9bc4ff; font-size: 0.9em; margin-bottom: 5px;">
                                        ${rec.familia} ‚Ä¢ R$ ${rec.preco}
                                    </div>
                                    <div style="color: #ccc; font-size: 0.9em; line-height: 1.5;">
                                        ${rec.desc}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                nextPurchase += `<div style="color: #888; font-size: 0.85em; margin-top: 15px; text-align: center; font-style: italic;">
                    üí° Estas recomenda√ß√µes foram calculadas baseadas no seu clima, or√ßamento e fam√≠lias que faltam na sua cole√ß√£o.
                </div>`;
                
                nextPurchase += `</div>`;
            }

            // BOT√ÉO PARA O AGENTE GPT COM CONTEXTO
            const missingNames = [...missing, ...weak].map(f => f.name).join(', ');
            const ambienteTextos = {
                'fechado': 'Fechado (escrit√≥rio, loja)',
                'aberto': 'Aberto (obra, rua, campo)',
                'ambos': 'Ambos'
            };
            const ambienteTexto = ambiente ? ambienteTextos[ambiente] : null;

            // Mapear or√ßamento para texto
            const orcamentoTextos = {
                'ate-350': 'At√© R$ 350',
                '350-1500': 'De R$ 350 a R$ 1.500',
                '1500-2500': 'De R$ 1.500 a R$ 2.500',
                'sem-limite': 'Sem limite de pre√ßo'
            };
            const orcamentoTexto = orcamento ? orcamentoTextos[orcamento] : null;

            let diagnosticoCompleto = `Ol√°! Acabei de fazer meu diagn√≥stico de cole√ß√£o de perfumes e preciso de ajuda.\n\n`;
            diagnosticoCompleto += `üìä MEU PERFIL:\n`;
            diagnosticoCompleto += `‚Ä¢ Total de perfumes: ${total}\n`;
            diagnosticoCompleto += `‚Ä¢ N√≠vel: ${level}\n`;
            if (climaRegiao) diagnosticoCompleto += `‚Ä¢ Clima: ${climaRegiao}\n`;
            if (orcamentoTexto) diagnosticoCompleto += `‚Ä¢ Or√ßamento: ${orcamentoTexto}\n`;
            if (ambienteTexto) diagnosticoCompleto += `‚Ä¢ Ambiente de trabalho: ${ambienteTexto}\n`;
            diagnosticoCompleto += `\n`;
            diagnosticoCompleto += `üìâ AN√ÅLISE DA COLE√á√ÉO:\n`;
            diagnosticoCompleto += `‚Ä¢ Fam√≠lia dominante: ${dominant.name} (${percentage}%)\n`;
            diagnosticoCompleto += `‚Ä¢ Fam√≠lias que faltam ou est√£o fracas: ${missingNames || 'Nenhuma'}\n`;
            diagnosticoCompleto += `\n`;
            diagnosticoCompleto += `üéØ O QUE PRECISO:\n`;
            diagnosticoCompleto += `Recomenda√ß√µes personalizadas de perfumes dispon√≠veis no Brasil que equilibrem minha cole√ß√£o, considerando meu clima, or√ßamento e estilo de vida.`;

            // Guardar diagn√≥stico no localStorage para copiar
            localStorage.setItem('diagnostico_completo', diagnosticoCompleto);

            const gptLink = `https://chatgpt.com/g/g-68f7ee5b09248191b9b56f84210bf9ab-o-perfumista`;

            nextPurchase += `
                                    
                   <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top: 30px;">
                        <button onclick="abrirPerfumistaNoMapa()" style="
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            color: #1e1e1e;
                            border: none;
                            padding: 18px 28px;
                            border-radius: 12px;
                            font-size: 1.05em;
                            font-weight: 800;
                            cursor: pointer;
                            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
                            transition: all 0.3s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(212, 175, 55, 0.6)';"
                          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.4)';">
                            <span style="font-size: 1.3em;">ü§ñ</span>
                            <span>Gerar op√ß√µes com I.A. aqui no Mapa</span>
                        </button>

                        <button onclick="copiarDiagnostico('${gptLink}')" style="
                            background: rgba(255,255,255,0.06);
                            color: #f4e5b1;
                            border: 2px solid rgba(212,175,55,0.35);
                            padding: 18px 22px;
                            border-radius: 12px;
                            font-size: 0.98em;
                            font-weight: 800;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#d4af37';"
                          onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(212,175,55,0.35)';">
                            <span style="font-size: 1.2em;">‚ÜóÔ∏è</span>
                            <span>Abrir no ChatGPT</span>
                        </button>
                    </div>

                    <div style="color: #888; font-size: 0.85em; margin-top: 12px; line-height: 1.4;">
                        Dica: a op√ß√£o ‚ÄúI.A. aqui no Mapa‚Äù abre o Perfumista dentro desta p√°gina (iframe).<br/>
                        Isso abre o ChatGPT em outra aba (voc√™ precisa estar logado).
                    </div>

                    <div id="perfumista-panel" style="
                        display: none;
                        margin-top: 18px;
                        background: rgba(0,0,0,0.18);
                        border: 2px solid rgba(212, 175, 55, 0.28);
                        border-radius: 16px;
                        padding: 14px;
                        text-align: left;
                    ">
                        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;">
                            <div style="color:#fff; font-weight:900; font-size: 1.05em;">
                                O Perfumista ‚Äî resposta dentro do Mapa
                            </div>
                            <button onclick="fecharPerfumistaNoMapa()" style="
                                background: rgba(255,255,255,0.06);
                                color: #f4e5b1;
                                border: 2px solid rgba(212,175,55,0.28);
                                padding: 8px 12px;
                                border-radius: 10px;
                                font-weight: 800;
                                cursor: pointer;
                            ">Fechar</button>
                        </div>

                        <iframe
                            id="perfumista-iframe"
                            src="https://vguerise.github.io/operfumista/"
                            scrolling="no"
                            style="width:100%; border:0; border-radius: 12px; background:#111; overflow:hidden; min-height:420px;"
                            loading="lazy"
                        ></iframe>
                    </div>
                </div>
            `;

            nextDiv.innerHTML = nextPurchase;

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Fun√ß√£o para copiar diagn√≥stico
        function copiarDiagnostico(gptLink) {
            const diagnostico = localStorage.getItem('diagnostico_completo');
            if (diagnostico) {
                navigator.clipboard.writeText(diagnostico).then(() => {
                    // Mostrar tutorial visual (N√ÉO abre o ChatGPT ainda)
                    mostrarTutorial(gptLink);
                }).catch(err => {
                    alert('N√£o foi poss√≠vel copiar automaticamente. Por favor, copie manualmente o diagn√≥stico acima.');
                });
            }
        }

        function mostrarTutorial(gptLink) {
            // Criar overlay
            const overlay = document.createElement('div');
            overlay.id = 'tutorial-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 2px solid #d4af37;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="text-align: center; color: #d4af37; font-size: 3em; margin-bottom: 20px;">
                        ‚úÖ
                    </div>
                    <div style="text-align: center; color: white; font-size: 1.5em; font-weight: 700; margin-bottom: 30px;">
                        Diagn√≥stico Copiado!
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="color: #ccc; font-size: 1.05em; line-height: 2; text-align: left;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">1</span>
                                <span>Clique no bot√£o abaixo para abrir o ChatGPT</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">2</span>
                                <span>Cole seu diagn√≥stico com <strong style="color: #d4af37;">Ctrl+V</strong> (ou <strong style="color: #d4af37;">‚åò+V</strong> no Mac)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">3</span>
                                <span>Envie e receba recomenda√ß√µes personalizadas!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; background: rgba(255, 100, 100, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ff6b6b;">
                                <span style="background: #ff6b6b; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">‚ö†</span>
                                <span style="color: #ffb3b3;"><strong style="color: #ff6b6b;">IMPORTANTE:</strong> Voc√™ precisa estar logado no ChatGPT para utilizar o Agente.</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <a href="${gptLink}" target="_blank" style="text-decoration: none;">
                            <button onclick="fecharTutorial()" style="
                                background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                                color: #1e1e1e;
                                border: none;
                                padding: 15px 35px;
                                border-radius: 10px;
                                font-size: 1.1em;
                                font-weight: 700;
                                cursor: pointer;
                                box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                Abrir ChatGPT agora ‚Üí
                            </button>
                        </a>
                    </div>

                    <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 20px; cursor: pointer;" onclick="fecharTutorial()">
                        Fechar (ou pressione ESC)
                    </div>
                </div>
            `;

            // Adicionar estilos de anima√ß√£o
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            // Fechar com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') fecharTutorial();
            });
        }

        function fecharTutorial() {
            const overlay = document.getElementById('tutorial-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }

        // Salvar contadores (9 fam√≠lias)
        ['fresco', 'aromatico', 'doce', 'amadeirado', 'especiado', 'aquatico', 'talco', 'floral', 'frutas'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('change', function() {
                    localStorage.setItem(`count_${id}`, this.value);
                });
                
                const saved = localStorage.getItem(`count_${id}`);
                if (saved) {
                    input.value = saved;
                }
            }
        });

        // Salvar ambiente de trabalho (SELECT)
        const ambienteSelect = document.getElementById('ambiente');
        if (ambienteSelect) {
            ambienteSelect.addEventListener('change', function() {
                localStorage.setItem('ambiente', this.value);
            });
            const savedAmbiente = localStorage.getItem('ambiente');
            if (savedAmbiente) {
                ambienteSelect.value = savedAmbiente;
            }
        }

        // Salvar or√ßamento
        const orcamentoSelect = document.getElementById('orcamento');
        if (orcamentoSelect) {
            orcamentoSelect.addEventListener('change', function() {
                localStorage.setItem('orcamento', this.value);
            });
            const savedOrcamento = localStorage.getItem('orcamento');
            if (savedOrcamento) {
                orcamentoSelect.value = savedOrcamento;
            }
        }
        
        // Restaurar clima selecionado ao carregar p√°gina
        const savedClima = localStorage.getItem('clima');
        if (savedClima) {
            document.getElementById('clima').value = savedClima;
            // Marcar o bot√£o correto visualmente
            const climaBtns = document.querySelectorAll('.clima-btn');
            climaBtns.forEach(btn => {
                const onclickStr = btn.getAttribute('onclick');
                if (onclickStr && onclickStr.includes(`'${savedClima}'`)) {
                    btn.classList.add(`selected-${savedClima}`);
                }
            });
        }

        // Anima√ß√£o ao entrar
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    </script>
</body>
</html>

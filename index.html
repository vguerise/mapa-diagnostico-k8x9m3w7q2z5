<!-- 
INSTRU√á√ïES DE MODIFICA√á√ÉO:

1. PROCURE no seu index(13).html a se√ß√£o:
   <div class="family-counter">
   (linha ~766)

2. SUBSTITUA toda a se√ß√£o family-counter (linhas 766-803) pelo seguinte c√≥digo:
-->

<!-- ========== IN√çCIO DO C√ìDIGO NOVO ========== -->

<div class="perfume-collection-manager">
    <h3 style="color: #d4af37; text-align: center; margin-bottom: 25px; font-size: 1.5em;">
        üìù Minha Cole√ß√£o de Perfumes
    </h3>
    
    <!-- Campo adicionar perfume -->
    <div style="
        background: rgba(212, 175, 55, 0.08);
        border: 2px solid rgba(212, 175, 55, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    ">
        <label style="color: #ccc; display: block; margin-bottom: 10px; font-size: 0.95em;">
            Digite o nome do perfume:
        </label>
        <div style="display: flex; gap: 10px;">
            <input 
                type="text" 
                id="perfume-input" 
                placeholder="Ex: Dior Sauvage EDT"
                style="
                    flex: 1;
                    padding: 12px 15px;
                    background: rgba(0, 0, 0, 0.4);
                    border: 2px solid rgba(212, 175, 55, 0.3);
                    border-radius: 10px;
                    color: white;
                    font-size: 1em;
                "
            >
            <button 
                onclick="adicionarPerfume()" 
                style="
                    padding: 12px 25px;
                    background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                    border: none;
                    border-radius: 10px;
                    color: #000;
                    font-weight: 700;
                    cursor: pointer;
                    font-size: 1em;
                    transition: all 0.3s ease;
                "
                onmouseover="this.style.transform='scale(1.05)'"
                onmouseout="this.style.transform='scale(1)'"
            >
                + ADICIONAR
            </button>
        </div>
    </div>
    
    <!-- Contador e bot√£o ver cole√ß√£o -->
    <div style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
    ">
        <div style="color: #ccc;">
            <span style="color: #d4af37; font-weight: 700; font-size: 1.2em;" id="perfume-count">0</span>
            <span style="margin-left: 5px;">perfumes na cole√ß√£o</span>
        </div>
        <button 
            onclick="abrirPopupColecao()" 
            id="btn-ver-colecao"
            style="
                padding: 10px 20px;
                background: rgba(212, 175, 55, 0.15);
                border: 2px solid rgba(212, 175, 55, 0.4);
                border-radius: 10px;
                color: #d4af37;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
            "
            onmouseover="this.style.background='rgba(212, 175, 55, 0.25)'; this.style.borderColor='#d4af37'"
            onmouseout="this.style.background='rgba(212, 175, 55, 0.15)'; this.style.borderColor='rgba(212, 175, 55, 0.4)'"
        >
            üëÅÔ∏è VER COLE√á√ÉO COMPLETA
        </button>
    </div>
</div>

<!-- ========== FIM DO C√ìDIGO NOVO ========== -->


<!-- 
3. AGORA PROCURE a fun√ß√£o analyzeCollection() 
   (linha ~866)

4. SUBSTITUA TODA a fun√ß√£o analyzeCollection() pelo seguinte:
-->

<script>
// ========== SUBSTITUIR analyzeCollection() ==========

function analyzeCollection() {
    // Pegar perfumes do localStorage
    const perfumes = JSON.parse(localStorage.getItem('minhaColecao') || '[]');
    
    if (perfumes.length === 0) {
        alert('‚ö†Ô∏è Adicione pelo menos 1 perfume √† sua cole√ß√£o para analisar!');
        return;
    }
    
    // Pegar dados do contexto
    const clima = document.getElementById('clima').value || 'temperado';
    const ambiente = document.getElementById('ambiente').value;
    const orcamento = document.getElementById('orcamento').value;
    
    // Validar campos obrigat√≥rios
    if (!ambiente) {
        alert('‚ö†Ô∏è Por favor, selecione seu ambiente de trabalho!');
        document.getElementById('ambiente').focus();
        return;
    }
    
    if (!orcamento) {
        alert('‚ö†Ô∏è Por favor, selecione sua faixa de or√ßamento!');
        document.getElementById('orcamento').focus();
        return;
    }
    
    // Montar diagn√≥stico completo para enviar ao Perfumista
    const diagnostico = `
COLE√á√ÉO COMPLETA:
${perfumes.map((p, i) => `${i + 1}. ${p}`).join('\n')}

CONTEXTO:
- Clima: ${clima === 'quente' ? 'üå°Ô∏è Quente' : clima === 'frio' ? '‚ùÑÔ∏è Frio' : 'üå§Ô∏è Temperado'}
- Ambiente de trabalho: ${ambiente === 'fechado' ? 'üè¢ Fechado' : ambiente === 'aberto' ? 'üå≥ Aberto' : 'üîÄ Ambos'}
- Faixa de or√ßamento: ${orcamento}

OBJETIVO:
Analise minha cole√ß√£o, identifique quais fam√≠lias olfativas EU J√Å TENHO e quais FALTAM.
Considerando meu clima, ambiente e or√ßamento, sugira os 3 MELHORES perfumes para EQUILIBRAR minha cole√ß√£o.
    `.trim();
    
    // Salvar diagn√≥stico no localStorage
    localStorage.setItem('diagnostico_completo', diagnostico);
    
    // Abrir iframe do Perfumista
    abrirPerfumistaNoMapa();
}
</script>


<!-- 
5. ADICIONE estas NOVAS FUN√á√ïES JavaScript no final do arquivo, antes do </script> final:
-->

<script>
// ========== FUN√á√ïES NOVAS PARA GERENCIAR COLE√á√ÉO ==========

// Fun√ß√£o para formatar nome em Title Case
function formatarNome(nome) {
    return nome
        .trim()
        .toLowerCase()
        .split(' ')
        .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1))
        .join(' ');
}

// Adicionar perfume
function adicionarPerfume() {
    const input = document.getElementById('perfume-input');
    let nome = input.value.trim();
    
    if (!nome) {
        alert('‚ö†Ô∏è Digite o nome do perfume!');
        return;
    }
    
    // Formatar nome (Title Case)
    nome = formatarNome(nome);
    
    // Pegar cole√ß√£o atual
    let colecao = JSON.parse(localStorage.getItem('minhaColecao') || '[]');
    
    // Verificar duplicata
    if (colecao.includes(nome)) {
        alert('‚ö†Ô∏è Este perfume j√° est√° na sua cole√ß√£o!');
        return;
    }
    
    // Adicionar √† cole√ß√£o
    colecao.push(nome);
    localStorage.setItem('minhaColecao', JSON.stringify(colecao));
    
    // Limpar input
    input.value = '';
    
    // Atualizar contador
    atualizarContador();
    
    // Feedback visual
    input.style.borderColor = '#00ff00';
    setTimeout(() => {
        input.style.borderColor = 'rgba(212, 175, 55, 0.3)';
    }, 500);
    
    console.log('‚úÖ Perfume adicionado:', nome);
}

// Atualizar contador
function atualizarContador() {
    const colecao = JSON.parse(localStorage.getItem('minhaColecao') || '[]');
    const count = colecao.length;
    document.getElementById('perfume-count').textContent = count;
    
    // Habilitar/desabilitar bot√£o ver cole√ß√£o
    const btn = document.getElementById('btn-ver-colecao');
    if (count === 0) {
        btn.style.opacity = '0.5';
        btn.style.cursor = 'not-allowed';
        btn.disabled = true;
    } else {
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
        btn.disabled = false;
    }
}

// Abrir popup da cole√ß√£o
function abrirPopupColecao() {
    const colecao = JSON.parse(localStorage.getItem('minhaColecao') || '[]');
    
    if (colecao.length === 0) {
        alert('‚ö†Ô∏è Sua cole√ß√£o est√° vazia!');
        return;
    }
    
    // Criar overlay
    const overlay = document.createElement('div');
    overlay.id = 'popup-colecao';
    overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease;
    `;
    
    // Criar conte√∫do do popup
    overlay.innerHTML = `
        <div style="
            background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
            border: 3px solid #d4af37;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
        ">
            <div style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
                padding-bottom: 20px;
                border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            ">
                <h2 style="color: #d4af37; margin: 0; font-size: 1.8em;">
                    üìö Minha Cole√ß√£o (${colecao.length})
                </h2>
                <button 
                    onclick="fecharPopupColecao()"
                    style="
                        background: rgba(255, 0, 0, 0.2);
                        border: 2px solid rgba(255, 0, 0, 0.4);
                        border-radius: 8px;
                        color: #ff6666;
                        padding: 8px 15px;
                        cursor: pointer;
                        font-weight: 600;
                    "
                >
                    ‚úï Fechar
                </button>
            </div>
            
            <div id="lista-perfumes" style="display: flex; flex-direction: column; gap: 12px;">
                ${colecao.map((perfume, index) => `
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 15px;
                        background: rgba(212, 175, 55, 0.08);
                        border: 2px solid rgba(212, 175, 55, 0.2);
                        border-radius: 12px;
                        transition: all 0.3s ease;
                    "
                    onmouseover="this.style.borderColor='rgba(212, 175, 55, 0.5)'; this.style.background='rgba(212, 175, 55, 0.12)'"
                    onmouseout="this.style.borderColor='rgba(212, 175, 55, 0.2)'; this.style.background='rgba(212, 175, 55, 0.08)'"
                    >
                        <div style="
                            display: flex;
                            align-items: center;
                            gap: 15px;
                            flex: 1;
                        ">
                            <span style="
                                color: #d4af37;
                                font-weight: 700;
                                font-size: 1.2em;
                                min-width: 30px;
                            ">${index + 1}.</span>
                            <span style="color: #fff; font-size: 1em;">${perfume}</span>
                        </div>
                        <button 
                            onclick="removerPerfume(${index})"
                            style="
                                background: rgba(255, 0, 0, 0.15);
                                border: 2px solid rgba(255, 0, 0, 0.3);
                                border-radius: 8px;
                                color: #ff6666;
                                padding: 8px 12px;
                                cursor: pointer;
                                font-size: 0.9em;
                                transition: all 0.3s ease;
                            "
                            onmouseover="this.style.background='rgba(255, 0, 0, 0.3)'; this.style.borderColor='#ff0000'"
                            onmouseout="this.style.background='rgba(255, 0, 0, 0.15)'; this.style.borderColor='rgba(255, 0, 0, 0.3)'"
                        >
                            üóëÔ∏è Excluir
                        </button>
                    </div>
                `).join('')}
            </div>
            
            <div style="
                margin-top: 25px;
                padding-top: 20px;
                border-top: 2px solid rgba(212, 175, 55, 0.3);
                text-align: center;
            ">
                <button 
                    onclick="limparColecao()"
                    style="
                        background: rgba(255, 0, 0, 0.2);
                        border: 2px solid rgba(255, 0, 0, 0.4);
                        border-radius: 10px;
                        color: #ff6666;
                        padding: 12px 25px;
                        cursor: pointer;
                        font-weight: 600;
                    "
                >
                    üóëÔ∏è LIMPAR TODA A COLE√á√ÉO
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(overlay);
}

// Fechar popup
function fecharPopupColecao() {
    const popup = document.getElementById('popup-colecao');
    if (popup) {
        popup.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => popup.remove(), 300);
    }
}

// Remover perfume
function removerPerfume(index) {
    if (!confirm('Tem certeza que deseja remover este perfume?')) {
        return;
    }
    
    let colecao = JSON.parse(localStorage.getItem('minhaColecao') || '[]');
    const perfumeRemovido = colecao[index];
    
    colecao.splice(index, 1);
    localStorage.setItem('minhaColecao', JSON.stringify(colecao));
    
    console.log('üóëÔ∏è Perfume removido:', perfumeRemovido);
    
    // Atualizar contador
    atualizarContador();
    
    // Fechar e reabrir popup (para atualizar lista)
    fecharPopupColecao();
    
    if (colecao.length > 0) {
        setTimeout(() => abrirPopupColecao(), 350);
    }
}

// Limpar toda a cole√ß√£o
function limparColecao() {
    if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° remover TODOS os perfumes da sua cole√ß√£o!\n\nTem certeza?')) {
        return;
    }
    
    localStorage.removeItem('minhaColecao');
    console.log('üóëÔ∏è Cole√ß√£o limpa!');
    
    atualizarContador();
    fecharPopupColecao();
}

// Event listener para Enter no input
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('perfume-input');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                adicionarPerfume();
            }
        });
    }
    
    // Atualizar contador ao carregar
    atualizarContador();
});

</script>

<!-- 
6. ADICIONE estas ANIMA√á√ïES no <style> (procure por @keyframes no seu arquivo):
-->

<style>
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}
</style>

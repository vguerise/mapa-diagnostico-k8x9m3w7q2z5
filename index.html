<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Cole√ß√£o de Perfumes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #999;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
        }

        .card-title {
            color: #d4af37;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .card-description {
            color: #ccc;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .examples {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .examples-title {
            color: #d4af37;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .examples-list {
            color: #aaa;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .section-title {
            color: white;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            text-align: center;
        }

        .levels {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 30px;
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }

        .level-title {
            color: #d4af37;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .level-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 0.95em;
        }

        .level-item strong {
            color: #d4af37;
            display: block;
            margin-bottom: 5px;
        }

        .interactive-note {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            color: #9bc4ff;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
            border: 2px solid rgba(212, 175, 55, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-container:hover {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.25), rgba(212, 175, 55, 0.1));
            border-color: #d4af37;
            transform: translateX(5px);
        }

        .checkbox-container input {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #d4af37;
        }

        .checkbox-container label {
            cursor: pointer;
            flex: 1;
            color: #f4e5b1;
            font-weight: 600;
            font-size: 1.05em;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .balance-section {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .balance-title {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .balance-description {
            color: #ccc;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .family-counter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .counter-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .counter-item label {
            color: #d4af37;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .counter-item input {
            width: 100%;
            padding: 10px;
            font-size: 1.2em;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 5px;
            color: white;
        }

        .counter-item input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: 600;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .result-box {
            margin-top: 30px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
        }

        .result-title {
            color: #d4af37;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            color: white;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-advice {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-next {
            color: #9bc4ff;
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .result-next strong {
            color: #fff;
        }

        .context-section {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .context-title {
            color: #9bc4ff;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .context-item label {
            color: #9bc4ff;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .context-item input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="text"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .context-item input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="number"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
            cursor: pointer;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: rgba(100, 150, 255, 0.1);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

    
/* üî¶ Flash nas recomenda√ß√µes novas (1s) */
@keyframes aiFlashGlow {
  0%   { box-shadow: 0 0 0 rgba(212,175,55,0.0); transform: translateY(0); }
  25%  { box-shadow: 0 0 26px rgba(212,175,55,0.35); transform: translateY(-2px); }
  60%  { box-shadow: 0 0 18px rgba(212,175,55,0.22); transform: translateY(-1px); }
  100% { box-shadow: 0 0 0 rgba(212,175,55,0.0); transform: translateY(0); }
}
.ai-reco-flash {
  animation: aiFlashGlow 1s ease-in-out 1;
}

</style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>MAPA DE COLE√á√ÉO PERFEITA</h1>
            <p class="subtitle">Monte sua cole√ß√£o sem redund√¢ncias e com fun√ß√£o real</p>
        </header>

        <h2 class="section-title">AS 6 FUN√á√ïES ESSENCIAIS</h2>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">üåû CALOR</div>
                <div class="card-description">
                    Perfume leve, fresco e que n√£o sufoca. Alta temperatura exige baixa densidade. Evite doces pesados e √¢mbares densos.
                </div>
                <div class="card-tags">
                    <span class="tag">C√≠trico</span>
                    <span class="tag">Aqu√°tico</span>
                    <span class="tag">Verde</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ C√≠trico + aqu√°tico<br>
                        ‚Ä¢ Verde fresco<br>
                        ‚Ä¢ Arom√°tico leve
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="calor">
                    <label for="calor">Tenho um perfume para calor</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ùÑÔ∏è FRIO</div>
                <div class="card-description">
                    Perfume denso, quente e envolvente. Baixa temperatura pede alta proje√ß√£o. Aqui entram os √¢mbares, especiarias e madeiras.
                </div>
                <div class="card-tags">
                    <span class="tag">√Çmbar</span>
                    <span class="tag">Madeira</span>
                    <span class="tag">Especiaria</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ √Çmbar + baunilha<br>
                        ‚Ä¢ Madeira seca + especiaria<br>
                        ‚Ä¢ Oriental denso
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="frio">
                    <label for="frio">Tenho um perfume para frio</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üíº TRABALHO</div>
                <div class="card-description">
                    Perfume discreto, profissional e sem polariza√ß√£o. M√©dio alcance, baixa do√ßura. Deve passar despercebido at√© ser notado de perto.
                </div>
                <div class="card-tags">
                    <span class="tag">Arom√°tico</span>
                    <span class="tag">Amadeirado seco</span>
                    <span class="tag">Fresco discreto</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Arom√°tico limpo<br>
                        ‚Ä¢ Amadeirado elegante<br>
                        ‚Ä¢ Fresco-seco balanceado
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="trabalho">
                    <label for="trabalho">Tenho um perfume para trabalho</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üåô NOITE</div>
                <div class="card-description">
                    Perfume marcante, de presen√ßa forte. Alta proje√ß√£o, notas intensas. Aqui voc√™ pode ousar: doces densos, especiarias, couro.
                </div>
                <div class="card-tags">
                    <span class="tag">Doce denso</span>
                    <span class="tag">Couro</span>
                    <span class="tag">Oriental intenso</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Doce + especiaria<br>
                        ‚Ä¢ Couro + fuma√ßa<br>
                        ‚Ä¢ √Çmbar + oud
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="noite">
                    <label for="noite">Tenho um perfume para noite</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚úçÔ∏è ASSINATURA</div>
                <div class="card-description">
                    Seu perfume identidade. O que te representa independente de contexto. Deve ser confort√°vel, vers√°til e voc√™ deve amar us√°-lo.
                </div>
                <div class="card-tags">
                    <span class="tag">Pessoal</span>
                    <span class="tag">Vers√°til</span>
                    <span class="tag">Confort√°vel</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Caracter√≠sticas:</div>
                    <div class="examples-list">
                        ‚Ä¢ Funciona em v√°rias situa√ß√µes<br>
                        ‚Ä¢ Voc√™ nunca cansa dele<br>
                        ‚Ä¢ As pessoas te associam a ele
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="assinatura">
                    <label for="assinatura">Tenho meu perfume assinatura</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üéä OCASI√ïES ESPECIAIS</div>
                <div class="card-description">
                    Perfume para momentos √∫nicos. Casamentos, festas, eventos importantes, anivers√°rios. Aquele que voc√™ reserva para ocasi√µes memor√°veis.
                </div>
                <div class="card-tags">
                    <span class="tag">Festivo</span>
                    <span class="tag">Marcante</span>
                    <span class="tag">Especial</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Ocasi√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Casamentos e formaturas<br>
                        ‚Ä¢ Festas e celebra√ß√µes<br>
                        ‚Ä¢ Jantares especiais e eventos
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="ocasioes">
                    <label for="ocasioes">Tenho perfume para ocasi√µes especiais</label>
                </div>
            </div>
        </div>

        <h2 class="section-title">üéØ DIAGN√ìSTICO AVAN√áADO: SUA COLE√á√ÉO EST√Å EQUILIBRADA?</h2>
        
        <div class="balance-section">
            <div class="balance-card">
                <div class="balance-title">Identifique sua fam√≠lia dominante</div>
                <div class="balance-description">
                    Conte quantos perfumes voc√™ tem de cada fam√≠lia. A fam√≠lia com mais perfumes √© sua dominante.
                </div>

                <div class="context-section">
                    <div class="context-title">üìç Contexto Pessoal</div>
                    <div style="
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 25px;
                    ">
                        <!-- COLUNA ESQUERDA: AMBIENTE + OR√áAMENTO -->
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="context-item">
                                <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üíº Ambiente de trabalho:</label>
                                <select id="ambiente" style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    font-size: 1em;
                                    background: rgba(0, 0, 0, 0.3);
                                    border: 2px solid rgba(100, 150, 255, 0.3);
                                    border-radius: 8px;
                                    color: white;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                " onfocus="this.style.borderColor='#9bc4ff'" onblur="this.style.borderColor='rgba(100, 150, 255, 0.3)'">
                                    <option value="" selected disabled>Selecione seu ambiente</option>
                                    <option value="fechado">Fechado (escrit√≥rio, loja)</option>
                                    <option value="aberto">Aberto (obra, rua, campo)</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                            
                            <div class="context-item">
                                <label for="orcamento" style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üí∞ Or√ßamento:</label>
                                <select id="orcamento" style="
                                    width: 100%;
                                    padding: 12px 15px;
                                    font-size: 1em;
                                    background: rgba(0, 0, 0, 0.3);
                                    border: 2px solid rgba(100, 150, 255, 0.3);
                                    border-radius: 8px;
                                    color: white;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                " onfocus="this.style.borderColor='#9bc4ff'" onblur="this.style.borderColor='rgba(100, 150, 255, 0.3)'">
                                    <option value="" selected disabled>Selecione sua faixa</option>
                                    <option value="ate-350">At√© R$ 350</option>
                                    <option value="350-1500">R$ 350 - R$ 1.500</option>
                                    <option value="1500-2500">R$ 1.500 - R$ 2.500</option>
                                    <option value="sem-limite">Sem limite</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- COLUNA DIREITA: CLIMA -->
                        <div class="context-item">
                            <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üå°Ô∏è Clima da sua regi√£o:</label>
                            <input type="hidden" id="clima" value="temperado">
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button type="button" onclick="selecionarClima('quente', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(255, 100, 100, 0.1);
                                    border: 2px solid rgba(255, 100, 100, 0.3);
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">‚òÄÔ∏è</div>
                                    <div style="font-weight: 600;">Quente</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Norte, Nordeste</div>
                                </button>
                                
                                <button type="button" onclick="selecionarClima('temperado', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(212, 175, 55, 0.3);
                                    border: 2px solid #d4af37;
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">üå§Ô∏è</div>
                                    <div style="font-weight: 600;">Temperado</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sudeste</div>
                                </button>
                                
                                <button type="button" onclick="selecionarClima('frio', this)" class="clima-btn" style="
                                    flex: 1;
                                    padding: 15px 10px;
                                    background: rgba(150, 200, 255, 0.1);
                                    border: 2px solid rgba(150, 200, 255, 0.3);
                                    color: white;
                                    border-radius: 10px;
                                    cursor: pointer;
                                    font-size: 0.95em;
                                    transition: all 0.3s;
                                    text-align: center;
                                ">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">‚ùÑÔ∏è</div>
                                    <div style="font-weight: 600;">Frio</div>
                                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sul</div>
                                </button>
                            </div>
                            
                            <style>
                                .clima-btn:hover {
                                    transform: translateY(-3px) scale(1.05);
                                    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
                                    border-color: #d4af37;
                                }
                                
                                .clima-btn.selected-quente {
                                    background: rgba(255, 100, 100, 0.3) !important;
                                    border-color: #ff6666 !important;
                                    box-shadow: 0 0 20px rgba(255, 100, 100, 0.6) !important;
                                }
                                
                                .clima-btn.selected-temperado {
                                    background: rgba(212, 175, 55, 0.3) !important;
                                    border-color: #d4af37 !important;
                                    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5) !important;
                                }
                                
                                .clima-btn.selected-frio {
                                    background: rgba(100, 150, 255, 0.3) !important;
                                    border-color: #6699ff !important;
                                    box-shadow: 0 0 20px rgba(100, 150, 255, 0.6) !important;
                                }
                            </style>
                        </div>
                    </div>
                    
                    <style>
                        @media (max-width: 768px) {
                            .context-section > div:nth-child(2) {
                                grid-template-columns: 1fr !important;
                            }
                        }
                    </style>
                </div>

                <!-- Cole√ß√£o do usu√°rio (lista com adicionar/remover) -->
        <div id="colecao-box" style="margin-top: 26px;">
            <div style="font-weight: 800; color: #d4af37; font-size: 1.15em; margin-bottom: 10px;">
                üß¥ Sua cole√ß√£o (adicione seus perfumes)
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                <input id="perfumeInput" type="text" placeholder="Digite um perfume e clique em Adicionar" style="
                    flex: 1 1 320px;
                    padding: 14px 14px;
                    border-radius: 10px;
                    border: 1px solid rgba(212,175,55,0.35);
                    background: rgba(0,0,0,0.45);
                    color: #fff;
                    outline: none;
                    font-size: 1.02em;
                ">
                <button id="btnAddPerfume" type="button" onclick="addPerfume()" style="
                    padding: 14px 18px;
                    border-radius: 10px;
                    border: 2px solid rgba(212,175,55,0.5);
                    background: rgba(212,175,55,0.18);
                    color: #f4e5b1;
                    font-weight: 800;
                    cursor: pointer;
                ">Adicionar</button>

                <button id="btnVerLista" type="button" onclick="openListaPopup()" style="
                    padding: 14px 18px;
                    border-radius: 10px;
                    border: 2px solid rgba(212,175,55,0.35);
                    background: rgba(0,0,0,0.25);
                    color: #f4e5b1;
                    font-weight: 800;
                    cursor: pointer;
                ">Ver lista completa</button>
            </div>

            <!-- A√ß√µes para gerar recomenda√ß√µes com I.A. -->
            <div style="margin-top: 14px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
                <button type="button" onclick="abrirPerfumistaNoMapa()" style="
                    background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                    color: #1e1e1e;
                    border: none;
                    padding: 16px 22px;
                    border-radius: 12px;
                    font-size: 1.05em;
                    font-weight: 900;
                    cursor: pointer;
                    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.35);
                    transition: all 0.25s ease;
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(212, 175, 55, 0.55)';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.35)';">
                    <span style="font-size: 1.2em;">ü§ñ</span>
                    <span>Gerar op√ß√µes com I.A.</span>
                </button>

                <button type="button" onclick="abrirNoChatGPT()" style="
                    background: rgba(0,0,0,0.25);
                    color: #f4e5b1;
                    border: 2px solid rgba(212,175,55,0.35);
                    padding: 16px 22px;
                    border-radius: 12px;
                    font-size: 1.05em;
                    font-weight: 900;
                    cursor: pointer;
                    transition: all 0.25s ease;
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#d4af37';"
                   onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(212,175,55,0.35)';">
                    <span style="font-size: 1.2em;">‚ÜóÔ∏è</span>
                    <span>Abrir no ChatGPT</span>
                </button>
            </div>


            <div id="perfumeChips" style="margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap;"></div>

            <div style="margin-top: 10px; color: #aaa; font-size: 0.95em; line-height: 1.4;">
                Dica: escreva o nome do perfume (ex.: ‚ÄúBleu de Chanel EDT‚Äù). Voc√™ pode remover depois.
            </div>
        </div>

        <!-- Popup da lista completa -->
        <div id="listaPopup" style="
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.65);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 18px;
        ">
            <div style="
                width: min(720px, 96vw);
                background: rgba(20,20,20,0.92);
                border: 2px solid rgba(212,175,55,0.45);
                border-radius: 16px;
                box-shadow: 0 0 40px rgba(0,0,0,0.6);
                padding: 18px 18px 12px 18px;
            ">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
                    <div style="color:#d4af37; font-weight:900; font-size:1.15em;">Sua lista completa (A‚ÄìZ)</div>
                    <button type="button" onclick="closeListaPopup()" style="
                        padding: 10px 14px;
                        border-radius: 10px;
                        border: 2px solid rgba(212,175,55,0.35);
                        background: rgba(0,0,0,0.25);
                        color: #f4e5b1;
                        font-weight: 800;
                        cursor: pointer;
                    ">Fechar</button>
                </div>

                <div id="listaPopupBody" style="
                    margin-top: 12px;
                    max-height: 55vh;
                    overflow: auto;
                    padding-right: 6px;
                "></div>
            </div>
        </div>

        <!-- Radar (spider) das fam√≠lias -->
        <div id="radarBox" style="margin-top: 26px; display:none;">
            <div style="font-weight: 800; color: #d4af37; font-size: 1.15em; margin-bottom: 10px;">
                üìà Distribui√ß√£o por fam√≠lias (radar)
            </div>
            <div style="
                background: rgba(0,0,0,0.35);
                border: 1px solid rgba(212,175,55,0.25);
                border-radius: 14px;
                padding: 14px;
            ">
                <canvas id="radarFamilias" height="260"></canvas>
                <div style="margin-top:10px; color:#999; font-size:0.92em; line-height:1.35;">
                    *Este gr√°fico aparece quando a IA (iframe) devolver a an√°lise de fam√≠lias.
                </div>
            </div>
        </div>

        <!-- üì¶ Recomenda√ß√µes da IA (renderizadas no Mapa Pai) -->
        <div id="aiRecsBox" style="margin-top: 22px; display:none;">
            <div style="
                background: rgba(0,0,0,0.32);
                border: 1px solid rgba(212,175,55,0.30);
                border-radius: 16px;
                padding: 18px 16px;
                box-shadow: 0 0 22px rgba(212,175,55,0.10);
            ">
                <div style="font-weight: 900; color: #d4af37; font-size: 1.25em; letter-spacing: 0.5px; text-align:center;">
                    üéÅ <span id="aiRecsTitle">3 RECOMENDA√á√ïES PARA EQUILIBRAR SUA COLE√á√ÉO</span>
                </div>
                <div style="margin-top: 6px; color:#bfbfbf; text-align:center; font-size: 0.98em; line-height: 1.35;">
                    Baseado na sua cole√ß√£o, clima e lacunas identificadas
                </div>

                <div id="aiRecsCards" style="margin-top: 16px; display:flex; flex-direction:column; gap: 14px;"></div>

                <div style="margin-top: 14px; color:#8f8f8f; font-size:0.92em; line-height:1.35; text-align:center;">
                    üí° Estas sugest√µes vieram da I.A. (O Perfumista) e mudam conforme sua cole√ß√£o.
                </div>
            </div>
        </div>

        <div id="result" class="result-box" style="display: none;">
                    <div class="result-title">üìä RESULTADO DA AN√ÅLISE</div>
                    <div id="dominant-family" class="result-content"></div>
                    <div id="balance-advice" class="result-advice"></div>
                    <div id="next-purchase" class="result-next"></div>
                </div>
            </div>
        </div>

        <div class="interactive-note">
            <h3 style="margin-bottom: 15px;">üìã COMO USAR ESTE MAPA</h3>
            <p style="line-height: 1.8;">
                1. Marque as caixas dos perfumes que voc√™ J√Å TEM<br>
                2. Veja quais fun√ß√µes est√£o descobertas<br>
                3. Seu pr√≥ximo perfume deve preencher uma lacuna real<br>
                4. Se todas as fun√ß√µes est√£o cobertas, voc√™ n√£o precisa comprar nada novo
            </p>
        </div>
    </div>

    <script>
        // ===============================================
        // FUN√á√ÉO: SELECIONAR CLIMA
        // Precisa estar no in√≠cio para os bot√µes inline
        // ===============================================
        function selecionarClima(clima, btn) {
            // Remover todas as classes de sele√ß√£o
            document.querySelectorAll('.clima-btn').forEach(function(b) {
                b.classList.remove('selected-quente');
                b.classList.remove('selected-temperado');
                b.classList.remove('selected-frio');
            });
            
            // Adicionar classe espec√≠fica do clima
            btn.classList.add('selected-' + clima);
            
            // Atualizar valor do input hidden
            document.getElementById('clima').value = clima;
            
            // Salvar no localStorage
            localStorage.setItem('clima', clima);
            
            console.log('‚úÖ Clima selecionado:', clima);
        }

        // Salvar estado dos checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                localStorage.setItem(this.id, this.checked);
            });
            
            // Carregar estado salvo
            const saved = localStorage.getItem(checkbox.id);
            if (saved === 'true') {
                checkbox.checked = true;
            }
        });

        // Analisar cole√ß√£o com loading

        function analyzeCollection() {
            // A an√°lise detalhada de fam√≠lias agora √© feita pela I.A. (no iframe).
            // Aqui s√≥ validamos e montamos o "diagn√≥stico base" (clima/or√ßamento/ambiente + lista de perfumes).
            const lista = (perfumesColecao || []).map(p => String(p || '').trim()).filter(Boolean);

            if (lista.length === 0) {
                alert('Adicione pelo menos 1 perfume na sua cole√ß√£o para continuar.');
                return false;
            }

            const climaRegiao = document.getElementById('clima')?.value || '';
            const orcamento = document.getElementById('orcamento')?.value || '';
            const ambiente = document.getElementById('ambiente')?.value || '';

            const linhas = [];
            linhas.push('üìå CONTEXTO DO USU√ÅRIO');
            if (climaRegiao) linhas.push(`‚Ä¢ Clima/Regi√£o: ${climaRegiao}`);
            if (orcamento) linhas.push(`‚Ä¢ Or√ßamento: ${orcamento}`);
            if (ambiente) linhas.push(`‚Ä¢ Ambiente de trabalho: ${ambiente}`);
            linhas.push('');
            linhas.push('üß¥ COLE√á√ÉO INFORMADA:');
            linhas.push(lista.join(', '));
            linhas.push('');
            linhas.push('Observa√ß√£o: a distribui√ß√£o por fam√≠lias e as recomenda√ß√µes ser√£o calculadas pela I.A.');

            const texto = linhas.join('\n');

            // guarda para o iframe e para refresh
            localStorage.setItem('diagnostico_completo', texto);

            // Atualiza uma √°rea de texto (se existir)
            const out = document.getElementById('analiseTexto');
            if (out) out.textContent = texto;

            return true;
        }



        function mostrarLoading() {
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px 60px;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px; animation: spin 1.5s linear infinite;">
                        üîÑ
                    </div>
                    <div style="color: #d4af37; font-size: 1.8em; font-weight: 700; margin-bottom: 15px;">
                        Analisando sua cole√ß√£o...
                    </div>
                    <div style="color: #ccc; font-size: 1em; margin-bottom: 25px;">
                        Processando dados e identificando padr√µes
                    </div>
                    
                    <div style="
                        width: 300px;
                        height: 8px;
                        background: rgba(212, 175, 55, 0.2);
                        border-radius: 10px;
                        overflow: hidden;
                        margin: 0 auto;
                    ">
                        <div id="progress-bar" style="
                            width: 0%;
                            height: 100%;
                            background: linear-gradient(90deg, #d4af37, #f4e5b1);
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        "></div>
                    </div>
                </div>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            let progress = 0;
            const interval = setInterval(() => {
                progress += 4;
                const bar = document.getElementById('progress-bar');
                if (bar) bar.style.width = progress + '%';
                if (progress >= 100) clearInterval(interval);
            }, 100);
        }

        function fecharLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        // ============================
        // Integra√ß√£o com O Perfumista (iframe)
        // ============================
        function mostrarLoadingPerfumista() {
            if (document.getElementById('perfumista-loading-overlay')) return;

            const overlay = document.createElement('div');
            overlay.id = 'perfumista-loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.88);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 2px solid rgba(212, 175, 55, 0.9);
                    border-radius: 20px;
                    padding: 32px 28px;
                    max-width: 560px;
                    width: calc(100% - 40px);
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.25);
                    text-align: center;
                ">
                    <div style="color:#d4af37; font-size:2.2em; margin-bottom:10px;">ü§ñ</div>
                    <div style="color:#fff; font-size:1.35em; font-weight:900; margin-bottom:8px;">
                        Consultando o Perfumista...
                    </div>
                    <div style="color:#bbb; font-size:1em; line-height:1.5;">
                        Isso pode levar alguns segundos. N√£o feche a p√°gina.
                    </div>
                    <div style="margin-top:16px; height:10px; border-radius:999px; overflow:hidden; background: rgba(212,175,55,0.15);">
                        <div style="height:100%; width:40%; background: linear-gradient(90deg,#d4af37,#f4e5b1); animation: perfBar 1.1s infinite ease-in-out;"></div>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);

            // injeta anima√ß√£o uma vez
            if (!document.getElementById('perfumista-loading-style')) {
                const style = document.createElement('style');
                style.id = 'perfumista-loading-style';
                style.innerHTML = `
                    @keyframes perfBar {
                        0% { transform: translateX(-60%); }
                        100% { transform: translateX(260%); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function fecharLoadingPerfumista() {
            const overlay = document.getElementById('perfumista-loading-overlay');
            if (!overlay) return;
            overlay.style.animation = 'fadeOut 0.25s ease';
            setTimeout(() => overlay.remove(), 250);
        }

        let perfumistaTimeout = null;

        
        
            // Atualiza o diagn√≥stico da cole√ß√£o (Top 3 lacunas) usando valores 0-10 por fam√≠lia
            function atualizarDiagnosticoColecao(valuesByKey) {
                const box = document.getElementById('perfumistaDiagnosticoBox');
                if (!box) return;

                const cfg = {
                    fresco:     { label: 'Fresco/C√≠trico', icon: 'üçã' },
                    aromatico:  { label: 'Arom√°tico/Verde', icon: 'üåø' },
                    doce:       { label: 'Doce/Gourmand', icon: 'üçØ' },
                    amadeirado: { label: 'Amadeirado', icon: 'ü™µ' },
                    especiado:  { label: 'Especiado/Oriental', icon: 'üî•' },
                    aquatico:   { label: 'Aqu√°tico', icon: 'üåä' },
                    talco:      { label: 'Talco/Foug√®re', icon: 'üßº' },
                    floral:     { label: 'Floral', icon: 'üå∏' },
                    frutas:     { label: 'Frutas', icon: 'üçì' },
                };

                const keys = Object.keys(cfg);
                const vals = keys.map(k => ({ key: k, v: Number(valuesByKey?.[k] ?? 0) }));
                vals.sort((a,b) => a.v - b.v);

                const top3 = vals.slice(0, 3);
                const minV = top3[0]?.v ?? 0;

                let statusTitle = 'Cole√ß√£o equilibrada';
                let statusDesc  = 'Voc√™ est√° cobrindo bem as principais fam√≠lias. Agora √© lapidar (varia√ß√µes e ocasi√µes).';

                const veryLow = vals.filter(x => x.v <= 2).length;
                if (veryLow >= 3) {
                    statusTitle = 'Cole√ß√£o bem desbalanceada';
                    statusDesc  = 'Tem lacunas claras. O pr√≥ximo perfume deve atacar as fam√≠lias mais fracas primeiro.';
                } else if (veryLow >= 1) {
                    statusTitle = 'Cole√ß√£o desbalanceada';
                    statusDesc  = 'Voc√™ j√° tem base, mas ainda faltam pilares importantes. Foque nas fam√≠lias mais fracas.';
                }

                const lacunasHtml = top3.map((x, i) => {
                    const meta = cfg[x.key] || { label: x.key, icon: '‚ú®' };
                    return `
                        <div style="display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background: rgba(0,0,0,0.35); border:1px solid rgba(212,175,55,0.25);">
                            <div style="width:34px; height:34px; border-radius:10px; display:flex; align-items:center; justify-content:center; background: rgba(212,175,55,0.18); border:1px solid rgba(212,175,55,0.35); font-size:18px;">
                                ${meta.icon}
                            </div>
                            <div style="flex:1; line-height:1.2;">
                                <div style="font-weight:800; color:#f4e5b1;">${i+1}. ${meta.label}</div>
                                <div style="color:#b9b9b9; font-size:0.92em;">Prioridade alta para pr√≥ximas compras</div>
                            </div>
                        </div>
                    `;
                }).join('');

                box.style.display = 'block';
                box.innerHTML = `
                    <div style="margin: 16px 0 14px; padding: 16px 16px 14px; border-radius: 16px; border: 2px solid rgba(212,175,55,0.35); background: rgba(0,0,0,0.25); box-shadow: 0 0 22px rgba(0,0,0,0.35);">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            <div style="width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; background: rgba(212,175,55,0.22); border:1px solid rgba(212,175,55,0.45);">üß†</div>
                            <div style="flex:1;">
                                <div style="font-size:1.06em; font-weight:900; color:#d4af37;">Diagn√≥stico da cole√ß√£o</div>
                                <div style="color:#b9b9b9; font-size:0.92em;">Baseado no seu gr√°fico (fam√≠lias)</div>
                            </div>
                            <div style="padding:6px 10px; border-radius:999px; font-weight:800; border:1px solid rgba(212,175,55,0.35); background: rgba(212,175,55,0.12); color:#f4e5b1;">
                                ${statusTitle}
                            </div>
                        </div>

                        <div style="color:#cfcfcf; margin: 0 0 12px; font-size:0.98em;">${statusDesc}</div>

                        <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
                            ${lacunasHtml}
                        </div>

                        <div style="margin-top:10px; color:#8f8f8f; font-size:0.9em;">
                            Dica: as recomenda√ß√µes da I.A. devem priorizar <b style="color:#f4e5b1;">${(cfg[top3[0]?.key]?.label || 'a fam√≠lia mais fraca')}</b>.
                        </div>
                    </div>
                `;

                // guarda top 3 para a I.A.
                window.__top3Lacunas = top3.map(x => cfg[x.key]?.label || x.key);
                window.__lacunaPrincipal = cfg[top3[0]?.key]?.label || top3[0]?.key || '';
            }


function ensurePerfumistaPanel() {
            // tenta achar pelo id atual; se n√£o achar, tenta por padr√µes; se ainda assim n√£o achar, cria um painel novo
            let panel = document.getElementById('perfumista-panel') || document.querySelector('[id*="perfumista"][id*="panel"]');
            let iframe = document.getElementById('perfumista-iframe') || document.querySelector('iframe[src*="operfumista"]') || document.querySelector('iframe[src*="o-perfumista"]');

            if (panel && !iframe) iframe = panel.querySelector('iframe');

            if (!panel) {
                panel = document.createElement('div');
                panel.id = 'perfumista-panel';
                panel.style.cssText = `
                    display:none;
                    margin-top:18px;
                    background: rgba(0,0,0,0.18);
                    border: 2px solid rgba(212, 175, 55, 0.28);
                    border-radius: 16px;
                    padding: 14px;
                    text-align: left;
                `;

                const header = document.createElement('div');
                header.style.cssText = 'display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;';
                header.innerHTML = '<div style="font-weight:800;color:#f4e5b1;">O Perfumista ‚Äî resposta dentro do Mapa</div>';
                const btn = document.createElement('button');
                btn.textContent = 'Fechar';
                btn.style.cssText = 'background: rgba(212,175,55,0.18); border: 2px solid rgba(212,175,55,0.35); color:#f4e5b1; padding:8px 12px; border-radius: 10px; font-weight:800; cursor:pointer;';
                btn.onclick = () => { panel.style.display='none'; };
                header.appendChild(btn);
                panel.appendChild(header);
            // √Årea do diagn√≥stico + recomenda√ß√µes (acima do chat/iframe)
            const diagHolder = document.createElement('div');
            diagHolder.id = 'perfumistaDiagnosticoBox';
            diagHolder.style.display = 'none';
            panel.appendChild(diagHolder);

            const recsHolder = document.createElement('div');
            recsHolder.id = 'perfumistaRecsHolder';
            panel.appendChild(recsHolder);

            // Move o box de recomenda√ß√µes (se existir) para dentro do painel
            const aiBox = document.getElementById('aiRecsBox');
            if (aiBox) {
                aiBox.style.display = 'none'; // s√≥ mostra quando chegar recomenda√ß√£o
                recsHolder.appendChild(aiBox);
            }


                iframe = document.createElement('iframe');
                iframe.id = 'perfumista-iframe';
                iframe.src = 'https://vguerise.github.io/operfumista/';
                iframe.scrolling = 'no';
                iframe.style.cssText = 'width:100%; border:0; border-radius:14px; background: transparent; min-height: 720px;';
                panel.appendChild(iframe);

                // tenta anexar abaixo do bloco de bot√µes; se n√£o achar, joga no fim da p√°gina
                const anchor = document.getElementById('perfumista-anchor') || document.querySelector('[data-perfumista-anchor="1"]') || document.querySelector('button[onclick*="abrirPerfumistaNoMapa"]')?.parentElement;
                (anchor ? anchor.parentElement : document.body).appendChild(panel);
            }

            if (!iframe) {
                // se por algum motivo o panel existe mas o iframe n√£o, cria um
                iframe = document.createElement('iframe');
                iframe.id = 'perfumista-iframe';
                iframe.src = 'https://vguerise.github.io/operfumista/';
                iframe.scrolling = 'no';
                iframe.style.cssText = 'width:100%; border:0; border-radius:14px; background: transparent; min-height: 720px;';
                panel.appendChild(iframe);
            }

            return { panel, iframe };
        }

function abrirPerfumistaNoMapa() {
            // Gera/atualiza a an√°lise escrita no Mapa (sem bot√£o separado)
            try { analyzeCollection(); } catch(e) {}

            const { panel, iframe } = ensurePerfumistaPanel();

const diagnostico = (getDiagnosticoForIA() || '').trim();
            if (!diagnostico) {
                alert('N√£o achei o diagn√≥stico completo. Fa√ßa a an√°lise primeiro.');
                return;
            }

            panel.style.display = 'block';
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });

            mostrarLoadingPerfumista();

            // safety timeout (se o iframe n√£o avisar, fecha o popup depois)
            if (perfumistaTimeout) clearTimeout(perfumistaTimeout);
            perfumistaTimeout = setTimeout(() => {
                fecharLoadingPerfumista();
            }, 45000);

            const sendToIframe = () => {
                try {
                    iframe.contentWindow.postMessage(
                        { source: 'mapa', type: 'set_and_run', text: diagnostico },
                        'https://vguerise.github.io'
                    );
                } catch (e) {
                    // se falhar, pelo menos tira o loading para o usu√°rio n√£o ficar preso
                    fecharLoadingPerfumista();
                }
            };

            // Se j√° carregou, manda; sen√£o, manda no load
            try {
                // alguns browsers permitem postMessage mesmo antes do load, mas garantimos:
                iframe.addEventListener('load', () => sendToIframe(), { once: true });
                // tenta mandar j√°
                sendToIframe();
            } catch (e) {
                fecharLoadingPerfumista();
            }
        }

        function fecharPerfumistaNoMapa() {
            const panel = document.getElementById('perfumista-panel');
            if (panel) panel.style.display = 'none';
            fecharLoadingPerfumista();
        }

        // Recebe status do iframe (Perfumista)
        
        // üß† Renderiza as recomenda√ß√µes da IA no layout premium (Mapa Pai)
        function renderAIRecommendations(recomendacoes) {
            const box = document.getElementById('aiRecsBox');
            const cards = document.getElementById('aiRecsCards');
            if (!box || !cards) return;
            box.style.display = 'block';

            const list = Array.isArray(recomendacoes) ? recomendacoes : [];

            if (!list.length) {
                box.style.display = 'none';
                cards.innerHTML = '';
                return;
            }

            // helper: pega campo por nomes comuns
            const pick = (obj, keys, fallback = '') => {
                for (const k of keys) {
                    if (obj && typeof obj === 'object' && obj[k] != null && String(obj[k]).trim() !== '') return String(obj[k]).trim();
                }
                return fallback;
            };

            // helper: emoji/fam√≠lia
            const emojiForFamily = (fam) => {
                const f = (fam || '').toLowerCase();
                if (f.includes('citr') || f.includes('fresc')) return 'üçã';
                if (f.includes('arom') || f.includes('verde') || f.includes('herb')) return 'üåø';
                if (f.includes('doce') || f.includes('gour') || f.includes('sweet')) return 'üçØ';
                if (f.includes('amad') || f.includes('wood')) return 'ü™µ';
                if (f.includes('espec') || f.includes('orient') || f.includes('spice')) return 'üî•';
                if (f.includes('aqua') || f.includes('mar') || f.includes('ocean')) return 'üåä';
                if (f.includes('tal') || f.includes('p√≥') || f.includes('powd') || f.includes('foug')) return 'üßº';
                if (f.includes('flor')) return 'üå∏';
                if (f.includes('frut') || f.includes('fruit')) return 'üçì';
                return '‚ú®';
            };

            const safe = (s) => (s || '').replace(/</g,'&lt;').replace(/>/g,'&gt;');

            cards.innerHTML = list.slice(0, 3).map((item, idx) => {
                // aceita string ou objeto
                const obj = (item && typeof item === 'object') ? item : { titulo: String(item ?? '').trim() };

                const nome = pick(obj, ['nome','title','titulo','name'], `Sugest√£o ${idx+1}`);
                const familia = pick(obj, ['familia','family','categoria','tipo'], '');
                const preco = pick(obj, ['preco','faixa_preco','faixa','price','price_range'], '');
                const resumo = pick(obj, ['resumo','descricao','descri√ß√£o','tagline','explicacao','explica√ß√£o','porque','porque_escolhi','porque_escolheu'], '');

                const icon = pick(obj, ['icon','emoji'], '') || emojiForFamily(familia);

                const linhaMeta = [familia, preco].filter(Boolean).join(' ‚Ä¢ ');

                return `
                    <div class="ai-reco-card ai-reco-flash" style="
                        background: rgba(0,0,0,0.28);
                        border: 1px solid rgba(212,175,55,0.22);
                        border-radius: 14px;
                        padding: 14px 14px;
                        position: relative;
                        overflow: hidden;
                    ">
                        <div style="display:flex; align-items:flex-start; gap: 12px;">
                            <div style="
                                width: 42px; height: 42px; min-width:42px;
                                border-radius: 999px;
                                background: rgba(212,175,55,0.18);
                                border: 2px solid rgba(212,175,55,0.75);
                                display:flex; align-items:center; justify-content:center;
                                color:#d4af37; font-weight: 900;
                                font-size: 1.05em;
                            ">${idx+1}</div>

                            <div style="flex:1;">
                                <div style="color:#d4af37; font-weight: 900; font-size: 1.18em; line-height: 1.25;">
                                    ${safe(nome)}
                                </div>

                                ${linhaMeta ? `
                                <div style="margin-top: 8px; color:#9fd0ff; font-weight: 700;">
                                    ${safe(icon)} <span style="color:#9fd0ff;">${safe(linhaMeta)}</span>
                                </div>` : ''}

                                ${resumo ? `
                                <div style="margin-top: 8px; color:#d6d6d6; font-size: 1.02em; line-height: 1.35;">
                                    ${safe(resumo)}
                                </div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // re-dispara a anima√ß√£o sempre que chegar coisa nova
            requestAnimationFrame(() => {
                document.querySelectorAll('.ai-reco-card').forEach((el) => {
                    el.classList.remove('ai-reco-flash');
                    void el.offsetWidth; // force reflow
                    el.classList.add('ai-reco-flash');
                });
            });

            box.style.display = 'block';
        }


        window.addEventListener('message', (event) => {
            if (event.origin !== 'https://vguerise.github.io') return;

            const data = event.data || {};

                // Radar: se o iframe mandar distribui√ß√£o de fam√≠lias
                if (data && (data.type === 'familias_radar' || data.type === 'familias')) {
                    try {
                    const _vals = data.values || data.familias || data.distribuicao || {};
                    window.__lastFamiliasRadar = _vals;
                    renderRadar(_vals);
                    try { atualizarDiagnosticoColecao(_vals); } catch(e) {}
                } catch(e) {}
                }

            if (data.source !== 'operfumista') return;

            // auto-ajuste de altura do iframe (evita scroll duplo)
            if (data.type === 'height' && data.height) {
                const iframe = document.getElementById('perfumista-iframe');
                if (iframe) iframe.style.height = (Number(data.height) + 20) + 'px';
                return;
            }

            // üì¶ Recomenda√ß√µes: o iframe manda e o Mapa Pai desenha
            if (data.type === 'recs') {
                try { renderAIRecommendations(data.recomendacoes || data.recs || data.items || []); } catch(e) {}
                return;
            }

            if (data.type === 'loading') {
                mostrarLoadingPerfumista();
            }

            if (data.type === 'done' || data.type === 'error') {
                fecharLoadingPerfumista();
                if (perfumistaTimeout) clearTimeout(perfumistaTimeout);
            }
        });

        // exp√µe para o onclick do HTML
        window.abrirPerfumistaNoMapa = abrirPerfumistaNoMapa;
        window.fecharPerfumistaNoMapa = fecharPerfumistaNoMapa;



        function processarAnalise(families, total) {
            // Pegar contexto pessoal
            const climaRegiao = document.getElementById('clima').value || 'temperado';
            const orcamento = document.getElementById('orcamento').value;
            const ambiente = document.getElementById('ambiente').value;

            // Contar fam√≠lias representadas
            const familiesRepresented = Object.values(families).filter(f => f.value > 0).length;

            // Encontrar fam√≠lia dominante
            let dominant = null;
            let maxValue = 0;
            Object.entries(families).forEach(([key, data]) => {
                if (data.value > maxValue) {
                    maxValue = data.value;
                    dominant = { key, ...data };
                }
            });

            const percentage = ((maxValue / total) * 100).toFixed(0);

            // CALCULAR N√çVEL DO COLECIONADOR
            let level = '';
            let levelEmoji = '';
            let levelAdvice = '';

            if (total >= 1 && total <= 5) {
                levelEmoji = 'üéØ';
                level = 'INICIANTE';
                levelAdvice = 'Voc√™ est√° come√ßando. Foque nas 5 fun√ß√µes b√°sicas (calor, frio, trabalho, noite, assinatura) antes de diversificar.';
            } else if (total >= 6 && total <= 10) {
                if (familiesRepresented >= 4 && percentage < 50) {
                    levelEmoji = '‚ö°';
                    level = 'INTERMEDI√ÅRIO';
                    levelAdvice = 'Cole√ß√£o crescendo bem. Continue diversificando e evite redund√¢ncias na fam√≠lia dominante.';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'INTERMEDI√ÅRIO (com desequil√≠brio)';
                    levelAdvice = 'Voc√™ tem quantidade de intermedi√°rio, mas est√° comprando muito da mesma fam√≠lia. Diversifique antes de expandir.';
                }
            } else if (total >= 11 && total <= 15) {
                if (familiesRepresented >= 5 && percentage <= 40) {
                    levelEmoji = 'üî•';
                    level = 'AVAN√áADO';
                    levelAdvice = 'Cole√ß√£o madura e equilibrada. Cada novo perfume deve preencher uma subfun√ß√£o espec√≠fica (ex: calor extremo, trabalho formal).';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'AVAN√áADO (com redund√¢ncia)';
                    levelAdvice = 'Voc√™ tem muitos perfumes, mas com sobreposi√ß√£o. Identifique os redundantes e considere vender/trocar antes de comprar mais.';
                }
            } else {
                if (percentage <= 35 && familiesRepresented >= 5) {
                    levelEmoji = 'üëë';
                    level = 'COLECIONADOR EQUILIBRADO';
                    levelAdvice = 'Cole√ß√£o extensa e diversificada. Agora o foco √©: cada perfume tem fun√ß√£o clara ou voc√™ est√° acumulando?';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'COLECIONADOR (com ac√∫mulo)';
                    levelAdvice = 'Voc√™ tem MUITOS perfumes, mas est√° acumulando redund√¢ncias. Pare de comprar. Venda os que n√£o usa e reorganize.';
                }
            }

            // Encontrar fam√≠lias ausentes ou fracas
            const missing = Object.entries(families)
                .filter(([key, data]) => data.value === 0)
                .map(([key, data]) => ({ key, ...data }));
            
            const weak = Object.entries(families)
                .filter(([key, data]) => data.value === 1)
                .map(([key, data]) => ({ key, ...data }));

            // Gerar an√°lise
            const resultDiv = document.getElementById('result');
            const dominantDiv = document.getElementById('dominant-family');
            const adviceDiv = document.getElementById('balance-advice');
            const nextDiv = document.getElementById('next-purchase');

            // Criar layout gr√°fico compacto para as informa√ß√µes
            const climaLabel = climaRegiao === 'quente' ? 'üå°Ô∏è Clima quente' : climaRegiao === 'frio' ? '‚ùÑÔ∏è Clima frio' : 'üå§Ô∏è Clima temperado';
            const ambienteLabel = ambiente === 'fechado' ? 'Fechado' : ambiente === 'aberto' ? 'Aberto' : ambiente === 'ambos' ? 'Ambos' : 'N√£o informado';
            
            const infoCards = `
                <div style="
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 12px;
                    margin-bottom: 20px;
                ">
                    ${climaRegiao ? `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.4);
                            border-radius: 8px;
                            padding: 12px;
                        ">
                            <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üå°Ô∏è CLIMA</div>
                            <div style="color: #fff; font-size: 0.95em; line-height: 1.5;">
                                <span style="color: #9bc4ff;">${climaLabel}</span>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${ambiente ? `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.4);
                            border-radius: 8px;
                            padding: 12px;
                        ">
                            <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üíº AMBIENTE</div>
                            <div style="color: #fff; font-size: 0.95em;">
                                ${ambienteLabel}
                            </div>
                        </div>
                    ` : ''}

                    
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                        border: 3px solid #d4af37;
                        border-radius: 8px;
                        padding: 12px;
                        grid-column: 1 / -1;
                    ">
                        <div style="font-size: 0.85em; color: #d4af37; margin-bottom: 8px; font-weight: 600;">üëë FAM√çLIA DOMINANTE</div>
                        <div style="color: #fff; font-size: 1.2em; font-weight: 700; margin-bottom: 4px;">
                            ${dominant.name}
                        </div>
                        <div style="color: #f4e5b1; font-size: 1em;">
                            ${maxValue} perfumes ¬∑ <strong style="color: #d4af37; font-size: 1.15em;">${percentage}%</strong> da cole√ß√£o
                        </div>
                    </div>
                </div>
                
                <style>
                    @media (max-width: 768px) {
                        #dominant-family > div:first-child {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            `;

            dominantDiv.innerHTML = `
                <div style="background: rgba(212, 175, 55, 0.15); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #d4af37;">
                    <div style="font-size: 1.3em; margin-bottom: 10px;">${levelEmoji} <strong>SEU N√çVEL: ${level}</strong></div>
                    <div style="color: #ccc; font-size: 0.95em;">${levelAdvice}</div>
                </div>
                ${infoCards}
            `;

            // An√°lise e conselhos
            let advice = '';
            let status = '';

            if (percentage >= 50) {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(255, 50, 50, 0.3), rgba(200, 0, 0, 0.2));
                        border: 4px solid #ff3333;
                        border-radius: 12px;
                        padding: 25px;
                        margin-bottom: 20px;
                        box-shadow: 0 0 30px rgba(255, 50, 50, 0.5);
                        animation: pulse-red 2s infinite;
                    ">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">üö®</div>
                        <div style="font-size: 1.5em; font-weight: 700; color: #ff6666; text-align: center; text-transform: uppercase;">
                            ATEN√á√ÉO: COLE√á√ÉO DESBALANCEADA!
                        </div>
                    </div>
                    <style>
                        @keyframes pulse-red {
                            0%, 100% { box-shadow: 0 0 30px rgba(255, 50, 50, 0.5); }
                            50% { box-shadow: 0 0 50px rgba(255, 50, 50, 0.8); }
                        }
                    </style>
                `;
                advice = `
                    <div style="font-size: 1.25em; line-height: 1.8; margin-top: 15px;">
                        <div style="text-align: center;">
                            <strong style="color: #ff6666; font-size: 1.4em;">VOC√ä EST√Å DESPERDI√áANDO DINHEIRO!</strong>
                        </div>
                        <br>
                        <span style="font-size: 1.15em; color: #fff;">
                            Voc√™ est√° viciado em <strong style="color: #d4af37;">${dominant.name}</strong>. 
                            Isso cria <strong style="color: #ff6666;">redund√¢ncia cr√≠tica</strong> ‚Äî voc√™ tem v√°rios perfumes fazendo a MESMA fun√ß√£o.
                        </span>
                        <br><br>
                        <strong style="color: #ffaa00; font-size: 1.15em;">üí∏ Resultado:</strong> 
                        <span style="font-size: 1.1em;">
                            Voc√™ gasta mais, usa menos, e n√£o tem op√ß√µes reais para diferentes situa√ß√µes.
                        </span>
                    </div>
                `;
            } else if (percentage >= 35) {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(255, 165, 0, 0.3), rgba(255, 140, 0, 0.2));
                        border: 4px solid #ff9933;
                        border-radius: 12px;
                        padding: 25px;
                        margin-bottom: 20px;
                        box-shadow: 0 0 30px rgba(255, 165, 0, 0.5);
                        animation: pulse-orange 2.5s infinite;
                    ">
                        <div style="font-size: 2em; text-align: center; margin-bottom: 10px;">‚ö†Ô∏è</div>
                        <div style="font-size: 1.4em; font-weight: 700; color: #ffaa00; text-align: center; text-transform: uppercase;">
                            Alerta: Cole√ß√£o com Vi√©s!
                        </div>
                    </div>
                    <style>
                        @keyframes pulse-orange {
                            0%, 100% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.5); }
                            50% { box-shadow: 0 0 45px rgba(255, 165, 0, 0.7); }
                        }
                    </style>
                `;
                advice = `
                    <div style="font-size: 1.25em; line-height: 1.8; margin-top: 15px;">
                        <div style="text-align: center;">
                            <strong style="color: #ffaa00; font-size: 1.3em;">SUA COLE√á√ÉO EST√Å DESEQUILIBRADA!</strong>
                        </div>
                        <br>
                        <span style="font-size: 1.15em; color: #fff;">
                            <strong style="color: #d4af37;">${dominant.name}</strong> domina sua cole√ß√£o (<strong style="color: #ffaa00; font-size: 1.2em;">${percentage}%</strong>). 
                            Voc√™ est√° comprando sempre o mesmo tipo de perfume.
                        </span>
                        <br><br>
                        <strong style="color: #ffcc66; font-size: 1.15em;">‚ö†Ô∏è Aten√ß√£o:</strong> 
                        <span style="font-size: 1.1em;">
                            Seu pr√≥ximo perfume <strong style="color: #ff6666;">N√ÉO</strong> deve ser dessa fam√≠lia. 
                            Voc√™ precisa diversificar <strong style="color: #ffaa00;">AGORA!</strong>
                        </span>
                    </div>
                `;
            } else {
                status = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div style="
                            display: inline-block;
                            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                            border: 2px solid #d4af37;
                            border-radius: 8px;
                            padding: 10px 30px;
                        ">
                            <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                                üìã DIAGN√ìSTICO
                            </span>
                        </div>
                    </div>
                    <div style="
                        background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
                        border: 3px solid rgba(76, 175, 80, 0.5);
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 20px;
                        text-align: center;
                    ">
                        <div style="font-size: 1.8em; margin-bottom: 8px;">‚úÖ</div>
                        <div style="font-size: 1.3em; font-weight: 700; color: #81c784;">
                            COLE√á√ÉO EQUILIBRADA
                        </div>
                    </div>
                `;
                advice = `Sua cole√ß√£o tem boa distribui√ß√£o entre fam√≠lias. Voc√™ tem op√ß√µes reais para diferentes contextos. Continue expandindo as fam√≠lias mais fracas antes de adicionar mais na dominante.`;
            }

            adviceDiv.innerHTML = status + advice;

            // RECOMENDA√á√ïES PERSONALIZADAS BASEADAS EM FAM√çLIAS FALTANTES
            let nextPurchase = '';
            
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += `
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border: 2px solid rgba(212, 175, 55, 0.3);
                        border-radius: 12px;
                        padding: 20px;
                        margin-bottom: 20px;
                    ">
                        <div style="
                            font-size: 1.2em;
                            font-weight: 700;
                            color: #d4af37;
                            margin-bottom: 15px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        ">
                            <span style="font-size: 1.5em;">üéØ</span>
                            <span>FAM√çLIAS QUE FALTAM</span>
                        </div>
                        
                        <div style="display: grid; gap: 12px;">
                `;
                
                // Cards compactos para cada fam√≠lia
                [...missing, ...weak].forEach(family => {
                    let icon, description, examples;
                    
                    if (family.key === 'fresco') {
                        icon = 'üçã';
                        description = 'Calor e ver√£o ¬∑ Trabalho aberto ¬∑ P√≥s-treino';
                        examples = 'C√≠tricos, √°gua de col√¥nia, bergamota';
                    } else if (family.key === 'aromatico') {
                        icon = 'üåø';
                        description = 'Vers√°til profissional ¬∑ Reuni√µes ¬∑ Uso di√°rio';
                        examples = 'Lavanda, s√°lvia, foug√®re';
                    } else if (family.key === 'doce') {
                        icon = 'üçØ';
                        description = 'Noite ¬∑ Encontros ¬∑ Frio ¬∑ Eventos';
                        examples = 'Baunilha, caramelo, tabaco doce';
                    } else if (family.key === 'amadeirado') {
                        icon = 'ü™µ';
                        description = 'Elegante formal ¬∑ Outono/inverno ¬∑ Cl√°ssico';
                        examples = 'S√¢ndalo, cedro, madeira nobre';
                    } else if (family.key === 'especiado') {
                        icon = 'üî•';
                        description = 'Frio intenso ¬∑ Noite ¬∑ Impacto';
                        examples = 'Canela, pimenta, incenso';
                    } else if (family.key === 'aquatico') {
                        icon = 'üåä';
                        description = 'Calor extremo ¬∑ Praia ¬∑ Esportes';
                        examples = '√Ågua marinha, oz√¥nico, mel√£o';
                    } else if (family.key === 'talco') {
                        icon = 'üßº';
                        description = 'Clean profissional ¬∑ P√≥s-barba ¬∑ Cl√°ssico';
                        examples = 'Talco, barbeiro, foug√®re tradicional';
                    } else if (family.key === 'frutas') {
                        icon = 'üçì';
                        description = 'Casual ¬∑ Jovem ¬∑ Climas quentes ¬∑ Uso diurno';
                        examples = 'Ma√ß√£, pera, frutas vermelhas, manga';
                    } else if (family.key === 'floral') {
                        icon = 'üå∏';
                        description = 'Elegante ¬∑ Rom√¢ntico ¬∑ Ambientes fechados ¬∑ Dia a dia';
                        examples = 'Rosa, jasmim, flor de laranjeira, √≠ris';
                    }

                    
                    nextPurchase += `
                        <div style="
                            background: rgba(0, 0, 0, 0.3);
                            border-left: 4px solid #d4af37;
                            padding: 12px 15px;
                            border-radius: 8px;
                            display: grid;
                            gap: 6px;
                        ">
                            <div style="
                                font-size: 1.1em;
                                font-weight: 700;
                                color: #fff;
                                display: flex;
                                align-items: center;
                                gap: 8px;
                            ">
                                <span style="font-size: 1.3em;">${icon}</span>
                                <span>${family.name}</span>
                            </div>
                            <div style="color: #bbb; font-size: 0.95em;">
                                ${description}
                            </div>
                            <div style="color: #888; font-size: 0.85em; font-style: italic;">
                                Ex: ${examples}
                            </div>
                        </div>
                    `;
                });
                
                nextPurchase += `
                        </div>
                    </div>
                `;

                // Card de clima
                if (climaRegiao) {
                    let climaIcon, climaTitle, climaMessage, climaColor;
                    
                    if (climaRegiao === 'quente') {
                        climaIcon = 'üå°Ô∏è';
                        climaTitle = 'REGI√ÉO QUENTE';
                        climaColor = '#ff6b35';
                        if (families.fresco.value === 0 || families.aquatico.value === 0) {
                            climaMessage = '<strong>PRIORIDADE M√ÅXIMA:</strong> Frescos/Aqu√°ticos s√£o essenciais. Sem eles, voc√™ vai sofrer no calor.';
                        } else {
                            climaMessage = '‚úÖ Voc√™ tem op√ß√µes para o calor. Mantenha essas fam√≠lias leves na rota√ß√£o.';
                        }
                    } else if (climaRegiao === 'frio') {
                        climaIcon = '‚ùÑÔ∏è';
                        climaTitle = 'REGI√ÉO FRIA';
                        climaColor = '#4a90e2';
                        if (families.doce.value === 0 || families.especiado.value === 0) {
                            climaMessage = '<strong>URGENTE:</strong> Doces e Especiados s√£o essenciais. Frescos v√£o desaparecer no frio.';
                        } else {
                            climaMessage = '‚úÖ Voc√™ tem op√ß√µes para o frio. Aproveite os densos e especiados.';
                        }
                    } else {
                        climaIcon = 'üå§Ô∏è';
                        climaTitle = 'CLIMA TEMPERADO';
                        climaColor = '#f4a460';
                        climaMessage = 'Clima vers√°til exige op√ß√µes para ambas as esta√ß√µes. Mantenha variedade.';
                    }
                    
                    nextPurchase += `
                        <div style="
                            background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                            border: 2px solid rgba(100, 150, 255, 0.3);
                            border-radius: 12px;
                            padding: 16px 20px;
                            margin-bottom: 20px;
                        ">
                            <div style="
                                font-size: 1.1em;
                                font-weight: 700;
                                color: ${climaColor};
                                margin-bottom: 10px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                            ">
                                <span style="font-size: 1.4em;">${climaIcon}</span>
                                <span>${climaTitle}</span>
                            </div>
                            <div style="color: #ccc; font-size: 0.95em; line-height: 1.6;">
                                ${climaMessage}
                            </div>
                        </div>
                    `;
                }

                // Card de ambiente de trabalho
                if (ambiente) {
                    let ambIcon = 'üíº';
                    let ambTitle = 'AMBIENTE DE TRABALHO';
                    let ambMessage = '';
                    
                    if (ambiente === 'fechado' || ambiente === 'ambos') {
                        if (families.aromatico.value === 0) {
                            ambMessage = 'üè¢ <strong>Ambiente fechado exige discretos!</strong> Arom√°tico/Verde √© ESSENCIAL para n√£o incomodar. Evite doces densos no escrit√≥rio.';
                        } else {
                            ambMessage = '‚úÖ Voc√™ tem arom√°ticos para o ambiente fechado. Perfeito para n√£o incomodar colegas.';
                        }
                    } else if (ambiente === 'aberto') {
                        ambMessage = 'üå≥ Ambiente aberto permite mais liberdade. Frescos e aqu√°ticos s√£o ideais para o ar livre.';
                    }
                    
                    if (ambMessage) {
                        nextPurchase += `
                            <div style="
                                background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                                border: 2px solid rgba(100, 150, 255, 0.3);
                                border-radius: 12px;
                                padding: 16px 20px;
                                margin-bottom: 20px;
                            ">
                                <div style="
                                    font-size: 1.1em;
                                    font-weight: 700;
                                    color: #9bc4ff;
                                    margin-bottom: 10px;
                                    display: flex;
                                    align-items: center;
                                    gap: 10px;
                                ">
                                    <span style="font-size: 1.4em;">${ambIcon}</span>
                                    <span>${ambTitle}</span>
                                </div>
                                <div style="color: #ccc; font-size: 0.95em; line-height: 1.6;">
                                    ${ambMessage}
                                </div>
                            </div>
                        `;
                    }
                }
                
            } else {
                nextPurchase += 'Todas as fam√≠lias est√£o representadas. Escolha baseado em <strong>fun√ß√£o</strong> (calor, frio, trabalho, noite) que esteja faltando.';
            }

            // Pr√≥ximos passos baseados no n√≠vel
            if (level.includes('INICIANTE')) {
                nextPurchase += `<br>üéØ <strong>PR√ìXIMO PASSO:</strong> Complete as 5 fun√ß√µes b√°sicas antes de pensar em variedade de fam√≠lias.`;
            } else if (level.includes('redund√¢ncia') || level.includes('ac√∫mulo')) {
                nextPurchase += `<br>üõë <strong>PARE DE COMPRAR.</strong> Identifique perfumes redundantes, venda ou troque, e s√≥ compre quando identificar uma lacuna funcional real.`;
            }

            // Regra de ouro
            nextPurchase += `<br><br>üéØ <strong>REGRA DE OURO:</strong> Se voc√™ n√£o consegue pensar em 3 situa√ß√µes espec√≠ficas onde usaria o perfume que est√° pensando em comprar, voc√™ N√ÉO precisa dele.`;

            // SISTEMA DE RECOMENDA√á√ÉO DE 3 PERFUMES ESPEC√çFICOS
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += `<br><br><div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.05)); padding: 20px; border-radius: 10px; border: 2px solid #d4af37;">`;
                            // (removido) sugest√µes fixas da base interna

const gptLink = `https://chatgpt.com/g/g-68f7ee5b09248191b9b56f84210bf9ab-o-perfumista`;

            nextPurchase += `
                                    
                   <div style="display:flex; gap:12px; flex-wrap:nowrap; justify-content:center; align-items:center; margin-top: 30px;">
                        <button onclick="abrirPerfumistaNoMapa()" style="
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            color: #1e1e1e;
                            border: none;
                            padding: 18px 28px;
                            border-radius: 12px;
                            font-size: 1.05em;
                            font-weight: 800;
                            cursor: pointer;
                            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
                            transition: all 0.3s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(212, 175, 55, 0.6)';"
                          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.4)';">
                            <span style="font-size: 1.3em;">ü§ñ</span>
                            <span>Gerar op√ß√µes com I.A. aqui no Mapa</span>
                        </button>
<button onclick="copiarDiagnostico('${gptLink}')" style="
                            background: rgba(255,255,255,0.06);
                            color: #f4e5b1;
                            border: 2px solid rgba(212,175,55,0.35);
                            padding: 18px 22px;
                            border-radius: 12px;
                            font-size: 0.98em;
                            font-weight: 800;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 10px;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='#d4af37';"
                          onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(212,175,55,0.35)';">
                            <span style="font-size: 1.2em;">‚ÜóÔ∏è</span>
                            <span>Abrir no ChatGPT</span>
                        </button>
</div>

                    <div style="color: #888; font-size: 0.85em; margin-top: 12px; line-height: 1.4;">
                        Dica: a op√ß√£o ‚ÄúI.A. aqui no Mapa‚Äù abre o Perfumista dentro desta p√°gina (iframe).<br/>
                        Isso abre o ChatGPT em outra aba (voc√™ precisa estar logado).
                    </div>

                    <div id="perfumista-panel" style="
                        display: none;
                        margin-top: 18px;
                        background: rgba(0,0,0,0.18);
                        border: 2px solid rgba(212, 175, 55, 0.28);
                        border-radius: 16px;
                        padding: 14px;
                        text-align: left;
                    ">
                        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;">
                            <div style="color:#fff; font-weight:900; font-size: 1.05em;">
                                O Perfumista ‚Äî resposta dentro do Mapa
                            </div>
                            <button onclick="fecharPerfumistaNoMapa()" style="
                                background: rgba(255,255,255,0.06);
                                color: #f4e5b1;
                                border: 2px solid rgba(212,175,55,0.28);
                                padding: 8px 12px;
                                border-radius: 10px;
                                font-weight: 800;
                                cursor: pointer;
                            ">Fechar</button>
                        </div>

                        <iframe
                            id="perfumista-iframe"
                            src="https://vguerise.github.io/operfumista/"
                            scrolling="no"
                            style="width:100%; border:0; border-radius: 12px; background:#111; overflow:hidden; min-height:420px;"
                            loading="lazy"
                        ></iframe>
                    </div>
                </div>
            `;

            nextDiv.innerHTML = nextPurchase;

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        }

        // Fun√ß√£o para copiar diagn√≥stico
        function copiarDiagnostico(gptLink) {
            const diagnostico = localStorage.getItem('diagnostico_completo');
            if (diagnostico) {
                navigator.clipboard.writeText(diagnostico).then(() => {
                    // Mostrar tutorial visual (N√ÉO abre o ChatGPT ainda)
                    mostrarTutorial(gptLink);
                }).catch(err => {
                    alert('N√£o foi poss√≠vel copiar automaticamente. Por favor, copie manualmente o diagn√≥stico acima.');
                });
            }


        function abrirNoChatGPT() {
            const url = 'https://chatgpt.com/g/g-68f7ee5b09248191b9b56f84210bf9ab-o-perfumista';
            // copia o diagn√≥stico (se existir) e mostra o tutorial, depois o usu√°rio abre em nova aba
            copiarDiagnostico(url);
        }

        }

        function mostrarTutorial(gptLink) {
            // Criar overlay
            const overlay = document.createElement('div');
            overlay.id = 'tutorial-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 2px solid #d4af37;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="text-align: center; color: #d4af37; font-size: 3em; margin-bottom: 20px;">
                        ‚úÖ
                    </div>
                    <div style="text-align: center; color: white; font-size: 1.5em; font-weight: 700; margin-bottom: 30px;">
                        Diagn√≥stico Copiado!
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="color: #ccc; font-size: 1.05em; line-height: 2; text-align: left;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">1</span>
                                <span>Clique no bot√£o abaixo para abrir o ChatGPT</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">2</span>
                                <span>Cole seu diagn√≥stico com <strong style="color: #d4af37;">Ctrl+V</strong> (ou <strong style="color: #d4af37;">‚åò+V</strong> no Mac)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">3</span>
                                <span>Envie e receba recomenda√ß√µes personalizadas!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; background: rgba(255, 100, 100, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ff6b6b;">
                                <span style="background: #ff6b6b; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">‚ö†</span>
                                <span style="color: #ffb3b3;"><strong style="color: #ff6b6b;">IMPORTANTE:</strong> Voc√™ precisa estar logado no ChatGPT para utilizar o Agente.</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <a href="${gptLink}" target="_blank" style="text-decoration: none;">
                            <button onclick="fecharTutorial()" style="
                                background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                                color: #1e1e1e;
                                border: none;
                                padding: 15px 35px;
                                border-radius: 10px;
                                font-size: 1.1em;
                                font-weight: 700;
                                cursor: pointer;
                                box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                Abrir ChatGPT agora ‚Üí
                            </button>
                        </a>
                    </div>

                    <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 20px; cursor: pointer;" onclick="fecharTutorial()">
                        Fechar (ou pressione ESC)
                    </div>
                </div>
            `;

            // Adicionar estilos de anima√ß√£o
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            // Fechar com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') fecharTutorial();
            });
        }

        function fecharTutorial() {
            const overlay = document.getElementById('tutorial-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }

        // Salvar contadores (9 fam√≠lias)
        ['fresco', 'aromatico', 'doce', 'amadeirado', 'especiado', 'aquatico', 'talco', 'floral', 'frutas'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('change', function() {
                    localStorage.setItem(`count_${id}`, this.value);
                });
                
                const saved = localStorage.getItem(`count_${id}`);
                if (saved) {
                    input.value = saved;
                }
            }
        });

        // Salvar ambiente de trabalho (SELECT)
        const ambienteSelect = document.getElementById('ambiente');
        if (ambienteSelect) {
            ambienteSelect.addEventListener('change', function() {
                localStorage.setItem('ambiente', this.value);
            });
            const savedAmbiente = localStorage.getItem('ambiente');
            if (savedAmbiente) {
                ambienteSelect.value = savedAmbiente;
            }
        }

        // Salvar or√ßamento
        const orcamentoSelect = document.getElementById('orcamento');
        if (orcamentoSelect) {
            orcamentoSelect.addEventListener('change', function() {
                localStorage.setItem('orcamento', this.value);
            });
            const savedOrcamento = localStorage.getItem('orcamento');
            if (savedOrcamento) {
                orcamentoSelect.value = savedOrcamento;
            }
        }
        
        // Restaurar clima selecionado ao carregar p√°gina
        const savedClima = localStorage.getItem('clima');
        if (savedClima) {
            document.getElementById('clima').value = savedClima;
            // Marcar o bot√£o correto visualmente
            const climaBtns = document.querySelectorAll('.clima-btn');
            climaBtns.forEach(btn => {
                const onclickStr = btn.getAttribute('onclick');
                if (onclickStr && onclickStr.includes(`'${savedClima}'`)) {
                    btn.classList.add(`selected-${savedClima}`);
                }
            });
        }

        // Anima√ß√£o ao entrar
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    


        // ===== Cole√ß√£o (lista de perfumes) =====
        let perfumesColecao = [];

        function normalizeName(s) {
            return (s || '').toString().trim().replace(/\s+/g, ' ');
        }

        function loadPerfumes() {
            try {
                const raw = localStorage.getItem('perfumes_colecao');
                perfumesColecao = raw ? JSON.parse(raw) : [];
                if (!Array.isArray(perfumesColecao)) perfumesColecao = [];
            } catch(e) {
                perfumesColecao = [];
            }
            perfumesColecao = perfumesColecao.map(normalizeName).filter(Boolean);
            perfumesColecao = Array.from(new Set(perfumesColecao)); // unique
            perfumesColecao.sort((a,b)=>a.localeCompare(b, 'pt-BR'));
        }

        function savePerfumes() {
            localStorage.setItem('perfumes_colecao', JSON.stringify(perfumesColecao));
        }

        function renderPerfumeChips() {
            const box = document.getElementById('perfumeChips');
            if (!box) return;
            if (!perfumesColecao.length) {
                box.innerHTML = '<div style="color:#888; font-size:0.95em;">Nenhum perfume adicionado ainda.</div>';
                return;
            }
            box.innerHTML = perfumesColecao.map((p, idx) => `
                <div style="
                    display:inline-flex;
                    align-items:center;
                    gap:10px;
                    padding: 10px 12px;
                    border-radius: 999px;
                    border: 1px solid rgba(212,175,55,0.30);
                    background: rgba(0,0,0,0.35);
                    color: #f4e5b1;
                    font-weight: 700;
                    font-size: 0.98em;
                ">
                    <span>${p}</span>
                    <button type="button" onclick="removePerfume(${idx})" style="
                        border: none;
                        background: rgba(212,175,55,0.18);
                        color: #f4e5b1;
                        font-weight: 900;
                        width: 26px;
                        height: 26px;
                        border-radius: 999px;
                        cursor: pointer;
                        line-height: 1;
                    " aria-label="Remover">√ó</button>
                </div>
            `).join('');
        }

        function addPerfume() {
            const inp = document.getElementById('perfumeInput');
            if (!inp) return;
            const name = normalizeName(inp.value);
            if (!name) return;
            if (!perfumesColecao.includes(name)) {
                perfumesColecao.push(name);
                perfumesColecao.sort((a,b)=>a.localeCompare(b, 'pt-BR'));
                savePerfumes();
                renderPerfumeChips();
            }
            inp.value = '';
            inp.focus();
        }

        function removePerfume(index) {
            perfumesColecao.splice(index, 1);
            savePerfumes();
            renderPerfumeChips();
        }

        function openListaPopup() {
            const pop = document.getElementById('listaPopup');
            const body = document.getElementById('listaPopupBody');
            if (!pop || !body) return;
            if (!perfumesColecao.length) {
                body.innerHTML = '<div style="color:#bbb; padding:12px 6px;">Nenhum perfume na lista.</div>';
            } else {
                body.innerHTML = perfumesColecao.map((p, idx) => `
                    <div style="
                        display:flex;
                        justify-content:space-between;
                        align-items:center;
                        gap:12px;
                        padding: 10px 8px;
                        border-bottom: 1px solid rgba(212,175,55,0.18);
                        color:#f4e5b1;
                        font-weight:700;
                    ">
                        <div style="flex:1;">${p}</div>
                        <button type="button" onclick="removePerfume(${idx}); openListaPopup();" style="
                            padding: 8px 10px;
                            border-radius: 10px;
                            border: 1px solid rgba(212,175,55,0.35);
                            background: rgba(212,175,55,0.12);
                            color: #f4e5b1;
                            font-weight: 900;
                            cursor: pointer;
                        ">Remover</button>
                    </div>
                `).join('');
            }
            pop.style.display = 'flex';
        }

        function closeListaPopup() {
            const pop = document.getElementById('listaPopup');
            if (pop) pop.style.display = 'none';
        }

        // Enter para adicionar
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && document.activeElement && document.activeElement.id === 'perfumeInput') {
                e.preventDefault();
                addPerfume();
            }
            if (e.key === 'Escape') {
                closeListaPopup();
            }
        });

        // ===== Diagn√≥stico para IA (iframe) =====
        function getDiagnosticoForIA() {
            // base: usa o que j√° existe no localStorage (gerado pelo Mapa), e injeta a lista de perfumes.
            const base = (localStorage.getItem('diagnostico_completo') || '').trim();
            const lista = (perfumesColecao || []).join(', ');
            const lacunaTxt = (window.__lacunaPrincipal ? `\nüéØ PRIORIDADE: Sugira principalmente perfumes da fam√≠lia ${window.__lacunaPrincipal} (ou das 2 mais fracas).\n` : '');
            if (!lista) return base + lacunaTxt;
            if (!base) return `üß¥ COLE√á√ÉO INFORMADA:\n${lista}\n` + lacunaTxt;
            // evita duplicar se j√° existir
            if (base.includes('üß¥ COLE√á√ÉO INFORMADA')) return base;
            return base + lacunaTxt + `\n\nüß¥ COLE√á√ÉO INFORMADA:\n${lista}\n`;
        }

        // ===== Radar das fam√≠lias (recebe do iframe) =====
        let radarChart = null;
        function renderRadar(valuesByKey) {
            const box = document.getElementById('radarBox');
            const canvas = document.getElementById('radarFamilias');
            if (!box || !canvas || typeof Chart === 'undefined') return;

            const order = [
                { key:'fresco', label:'Fresco/C√≠trico' },
                { key:'aromatico', label:'Arom√°tico/Verde' },
                { key:'aquatico', label:'Aqu√°tico' },
                { key:'floral', label:'Floral' },
                { key:'frutas', label:'Frutas' },
                { key:'doce', label:'Doce/Gourmand' },
                { key:'especiado', label:'Especiado/Oriental' },
                { key:'amadeirado', label:'Amadeirado' },
                { key:'talco', label:'Talco/Foug√®re' }
            ];

            const labels = order.map(o => o.label);
            const data = order.map(o => {
                const v = valuesByKey && (valuesByKey[o.key] ?? valuesByKey[o.label] ?? 0);
                return Math.max(0, Math.min(100, Number(v) || 0));
            });

            box.style.display = 'block';

            if (radarChart) radarChart.destroy();
            radarChart = new Chart(canvas.getContext('2d'), {
                type: 'radar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Distribui√ß√£o (%)',
                        data
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            suggestedMax: 100,
                            ticks: { display: false },
                            grid: { color: 'rgba(255,255,255,0.12)' },
                            angleLines: { color: 'rgba(255,255,255,0.12)' },
                            pointLabels: { color: '#f4e5b1', font: { size: 12, weight: '700' } }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Boot
        (function initColecaoUI(){
            loadPerfumes();
            renderPerfumeChips();
        })();
    </script>
</body>
</html>

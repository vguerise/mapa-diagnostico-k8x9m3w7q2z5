<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Cole√ß√£o de Perfumes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #999;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: #d4af37;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
        }

        .card-title {
            color: #d4af37;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .card-description {
            color: #ccc;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .tag {
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .examples {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .examples-title {
            color: #d4af37;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .examples-list {
            color: #aaa;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .section-title {
            color: white;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            text-align: center;
        }

        .levels {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .level-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 30px;
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }

        .level-title {
            color: #d4af37;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .level-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 0.95em;
        }

        .level-item strong {
            color: #d4af37;
            display: block;
            margin-bottom: 5px;
        }

        .interactive-note {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            color: #9bc4ff;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
            border: 2px solid rgba(212, 175, 55, 0.4);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-container:hover {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.25), rgba(212, 175, 55, 0.1));
            border-color: #d4af37;
            transform: translateX(5px);
        }

        .checkbox-container input {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #d4af37;
        }

        .checkbox-container label {
            cursor: pointer;
            flex: 1;
            color: #f4e5b1;
            font-weight: 600;
            font-size: 1.05em;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .balance-section {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .balance-title {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .balance-description {
            color: #ccc;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .family-counter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .counter-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .counter-item label {
            color: #d4af37;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .counter-item input {
            width: 100%;
            padding: 10px;
            font-size: 1.2em;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 5px;
            color: white;
        }

        .counter-item input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: 600;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .result-box {
            margin-top: 30px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
        }

        .result-title {
            color: #d4af37;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            color: white;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-advice {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-next {
            color: #9bc4ff;
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .result-next strong {
            color: #fff;
        }

        .context-section {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .context-title {
            color: #9bc4ff;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .context-item label {
            color: #9bc4ff;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .context-item input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="text"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .context-item input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="number"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
            cursor: pointer;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: rgba(100, 150, 255, 0.1);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MAPA DE COLE√á√ÉO EQUILIBRADA</h1>
            <p class="subtitle">Monte sua cole√ß√£o sem redund√¢ncias e com fun√ß√£o real</p>
        </header>

        <h2 class="section-title">AS 6 FUN√á√ïES ESSENCIAIS</h2>
        
        <div class="grid">
            <div class="card">
                <div class="card-title">üåû CALOR</div>
                <div class="card-description">
                    Perfume leve, fresco e que n√£o sufoca. Alta temperatura exige baixa densidade. Evite doces pesados e √¢mbares densos.
                </div>
                <div class="card-tags">
                    <span class="tag">C√≠trico</span>
                    <span class="tag">Aqu√°tico</span>
                    <span class="tag">Verde</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ C√≠trico + aqu√°tico<br>
                        ‚Ä¢ Verde fresco<br>
                        ‚Ä¢ Arom√°tico leve
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="calor">
                    <label for="calor">Tenho um perfume para calor</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ùÑÔ∏è FRIO</div>
                <div class="card-description">
                    Perfume denso, quente e envolvente. Baixa temperatura pede alta proje√ß√£o. Aqui entram os √¢mbares, especiarias e madeiras.
                </div>
                <div class="card-tags">
                    <span class="tag">√Çmbar</span>
                    <span class="tag">Madeira</span>
                    <span class="tag">Especiaria</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ √Çmbar + baunilha<br>
                        ‚Ä¢ Madeira seca + especiaria<br>
                        ‚Ä¢ Oriental denso
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="frio">
                    <label for="frio">Tenho um perfume para frio</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üíº TRABALHO</div>
                <div class="card-description">
                    Perfume discreto, profissional e sem polariza√ß√£o. M√©dio alcance, baixa do√ßura. Deve passar despercebido at√© ser notado de perto.
                </div>
                <div class="card-tags">
                    <span class="tag">Arom√°tico</span>
                    <span class="tag">Amadeirado seco</span>
                    <span class="tag">Fresco discreto</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Arom√°tico limpo<br>
                        ‚Ä¢ Amadeirado elegante<br>
                        ‚Ä¢ Fresco-seco balanceado
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="trabalho">
                    <label for="trabalho">Tenho um perfume para trabalho</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üåô NOITE</div>
                <div class="card-description">
                    Perfume marcante, de presen√ßa forte. Alta proje√ß√£o, notas intensas. Aqui voc√™ pode ousar: doces densos, especiarias, couro.
                </div>
                <div class="card-tags">
                    <span class="tag">Doce denso</span>
                    <span class="tag">Couro</span>
                    <span class="tag">Oriental intenso</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Constru√ß√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Doce + especiaria<br>
                        ‚Ä¢ Couro + fuma√ßa<br>
                        ‚Ä¢ √Çmbar + oud
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="noite">
                    <label for="noite">Tenho um perfume para noite</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚úçÔ∏è ASSINATURA</div>
                <div class="card-description">
                    Seu perfume identidade. O que te representa independente de contexto. Deve ser confort√°vel, vers√°til e voc√™ deve amar us√°-lo.
                </div>
                <div class="card-tags">
                    <span class="tag">Pessoal</span>
                    <span class="tag">Vers√°til</span>
                    <span class="tag">Confort√°vel</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Caracter√≠sticas:</div>
                    <div class="examples-list">
                        ‚Ä¢ Funciona em v√°rias situa√ß√µes<br>
                        ‚Ä¢ Voc√™ nunca cansa dele<br>
                        ‚Ä¢ As pessoas te associam a ele
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="assinatura">
                    <label for="assinatura">Tenho meu perfume assinatura</label>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üéä OCASI√ïES ESPECIAIS</div>
                <div class="card-description">
                    Perfume para momentos √∫nicos. Casamentos, festas, eventos importantes, anivers√°rios. Aquele que voc√™ reserva para ocasi√µes memor√°veis.
                </div>
                <div class="card-tags">
                    <span class="tag">Festivo</span>
                    <span class="tag">Marcante</span>
                    <span class="tag">Especial</span>
                </div>
                <div class="examples">
                    <div class="examples-title">Ocasi√µes ideais:</div>
                    <div class="examples-list">
                        ‚Ä¢ Casamentos e formaturas<br>
                        ‚Ä¢ Festas e celebra√ß√µes<br>
                        ‚Ä¢ Jantares especiais e eventos
                    </div>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="ocasioes">
                    <label for="ocasioes">Tenho perfume para ocasi√µes especiais</label>
                </div>
            </div>
        </div>

        <h2 class="section-title">üéØ DIAGN√ìSTICO AVAN√áADO: SUA COLE√á√ÉO EST√Å EQUILIBRADA?</h2>
        
        <div class="balance-section">
            <div class="balance-card">
                <div class="balance-title">Identifique sua fam√≠lia dominante</div>
                <div class="balance-description">
                    Conte quantos perfumes voc√™ tem de cada fam√≠lia. A fam√≠lia com mais perfumes √© sua dominante.
                </div>

                <div class="context-section">
                    <div class="context-title">üìç Contexto Pessoal</div>
                    <div class="context-grid">
                        <div class="context-item">
                            <label for="cidade">Cidade onde mora:</label>
                            <input type="text" id="cidade" placeholder="Ex: S√£o Paulo, Rio de Janeiro...">
                        </div>
                        <div class="context-item">
                            <label for="custo-medio">Custo m√©dio da cole√ß√£o (R$):</label>
                            <input type="number" id="custo-medio" placeholder="Ex: 150, 300, 500..." min="0">
                            <div style="color: #888; font-size: 0.85em; margin-top: 5px;">M√©dia que voc√™ gasta por perfume</div>
                        </div>
                        <div class="context-item">
                            <label>Ambiente de trabalho:</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="amb-fechado" value="fechado">
                                    <span>Fechado (escrit√≥rio, loja)</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="amb-aberto" value="aberto">
                                    <span>Aberto (obra, rua, campo)</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="amb-ambos" value="ambos">
                                    <span>Ambos (varia)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="family-counter">
                    <div class="counter-item">
                        <label>üçã Fresco/C√≠trico</label>
                        <input type="number" id="fresco" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üåø Arom√°tico/Verde</label>
                        <input type="number" id="aromatico" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üçØ Doce/Gourmand</label>
                        <input type="number" id="doce" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>ü™µ Amadeirado</label>
                        <input type="number" id="amadeirado" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üî• Especiado/Oriental</label>
                        <input type="number" id="especiado" min="0" max="20" value="0">
                    </div>
                    <div class="counter-item">
                        <label>üåä Aqu√°tico</label>
                        <input type="number" id="aquatico" min="0" max="20" value="0">
                    </div>
                </div>

                <button class="analyze-btn" onclick="analyzeCollection()">ANALISAR COLE√á√ÉO</button>

                <div id="result" class="result-box" style="display: none;">
                    <div class="result-title">üìä RESULTADO DA AN√ÅLISE</div>
                    <div id="dominant-family" class="result-content"></div>
                    <div id="balance-advice" class="result-advice"></div>
                    <div id="next-purchase" class="result-next"></div>
                </div>
            </div>
        </div>

        <div class="interactive-note">
            <h3 style="margin-bottom: 15px;">üìã COMO USAR ESTE MAPA</h3>
            <p style="line-height: 1.8;">
                1. Marque as caixas dos perfumes que voc√™ J√Å TEM<br>
                2. Veja quais fun√ß√µes est√£o descobertas<br>
                3. Seu pr√≥ximo perfume deve preencher uma lacuna real<br>
                4. Se todas as fun√ß√µes est√£o cobertas, voc√™ n√£o precisa comprar nada novo
            </p>
        </div>
    </div>

    <script>
        // Salvar estado dos checkboxes
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                localStorage.setItem(this.id, this.checked);
            });
            
            // Carregar estado salvo
            const saved = localStorage.getItem(checkbox.id);
            if (saved === 'true') {
                checkbox.checked = true;
            }
        });

        // Analisar cole√ß√£o
        function analyzeCollection() {
            const families = {
                'fresco': { name: 'üçã Fresco/C√≠trico', value: parseInt(document.getElementById('fresco').value) || 0 },
                'aromatico': { name: 'üåø Arom√°tico/Verde', value: parseInt(document.getElementById('aromatico').value) || 0 },
                'doce': { name: 'üçØ Doce/Gourmand', value: parseInt(document.getElementById('doce').value) || 0 },
                'amadeirado': { name: 'ü™µ Amadeirado', value: parseInt(document.getElementById('amadeirado').value) || 0 },
                'especiado': { name: 'üî• Especiado/Oriental', value: parseInt(document.getElementById('especiado').value) || 0 },
                'aquatico': { name: 'üåä Aqu√°tico', value: parseInt(document.getElementById('aquatico').value) || 0 }
            };

            const total = Object.values(families).reduce((sum, f) => sum + f.value, 0);

            if (total === 0) {
                alert('Adicione pelo menos 1 perfume para analisar');
                return;
            }

            // Pegar contexto pessoal
            const cidade = document.getElementById('cidade').value.trim();
            const custoMedio = parseInt(document.getElementById('custo-medio').value) || 0;
            const ambFechado = document.getElementById('amb-fechado').checked;
            const ambAberto = document.getElementById('amb-aberto').checked;
            const ambAmbos = document.getElementById('amb-ambos').checked;

            // Detectar clima da regi√£o
            const cidadesQuentes = ['manaus', 'fortaleza', 'recife', 'salvador', 'natal', 'bel√©m', 'rio de janeiro', 'vit√≥ria', 'macei√≥', 'aracaju', 'teresina', 'palmas', 'cuiab√°', 'campo grande', 'goi√¢nia', 'bras√≠lia'];
            const cidadesFrias = ['curitiba', 'florian√≥polis', 'porto alegre', 'caxias do sul', 'gramado', 'canela', 'blumenau', 'joinville'];
            
            let climaRegiao = 'temperado';
            const cidadeLower = cidade.toLowerCase();
            
            if (cidadesQuentes.some(c => cidadeLower.includes(c))) {
                climaRegiao = 'quente';
            } else if (cidadesFrias.some(c => cidadeLower.includes(c))) {
                climaRegiao = 'frio';
            }

            // Contar fam√≠lias representadas
            const familiesRepresented = Object.values(families).filter(f => f.value > 0).length;

            // Encontrar fam√≠lia dominante
            let dominant = null;
            let maxValue = 0;
            Object.entries(families).forEach(([key, data]) => {
                if (data.value > maxValue) {
                    maxValue = data.value;
                    dominant = { key, ...data };
                }
            });

            const percentage = ((maxValue / total) * 100).toFixed(0);

            // CALCULAR N√çVEL DO COLECIONADOR
            let level = '';
            let levelEmoji = '';
            let levelAdvice = '';

            if (total >= 1 && total <= 5) {
                levelEmoji = 'üéØ';
                level = 'INICIANTE';
                levelAdvice = 'Voc√™ est√° come√ßando. Foque nas 5 fun√ß√µes b√°sicas (calor, frio, trabalho, noite, assinatura) antes de diversificar.';
            } else if (total >= 6 && total <= 10) {
                if (familiesRepresented >= 4 && percentage < 50) {
                    levelEmoji = '‚ö°';
                    level = 'INTERMEDI√ÅRIO';
                    levelAdvice = 'Cole√ß√£o crescendo bem. Continue diversificando e evite redund√¢ncias na fam√≠lia dominante.';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'INTERMEDI√ÅRIO (com desequil√≠brio)';
                    levelAdvice = 'Voc√™ tem quantidade de intermedi√°rio, mas est√° comprando muito da mesma fam√≠lia. Diversifique antes de expandir.';
                }
            } else if (total >= 11 && total <= 15) {
                if (familiesRepresented >= 5 && percentage <= 40) {
                    levelEmoji = 'üî•';
                    level = 'AVAN√áADO';
                    levelAdvice = 'Cole√ß√£o madura e equilibrada. Cada novo perfume deve preencher uma subfun√ß√£o espec√≠fica (ex: calor extremo, trabalho formal).';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'AVAN√áADO (com redund√¢ncia)';
                    levelAdvice = 'Voc√™ tem muitos perfumes, mas com sobreposi√ß√£o. Identifique os redundantes e considere vender/trocar antes de comprar mais.';
                }
            } else {
                if (percentage <= 35 && familiesRepresented >= 5) {
                    levelEmoji = 'üëë';
                    level = 'COLECIONADOR EQUILIBRADO';
                    levelAdvice = 'Cole√ß√£o extensa e diversificada. Agora o foco √©: cada perfume tem fun√ß√£o clara ou voc√™ est√° acumulando?';
                } else {
                    levelEmoji = '‚ö†Ô∏è';
                    level = 'COLECIONADOR (com ac√∫mulo)';
                    levelAdvice = 'Voc√™ tem MUITOS perfumes, mas est√° acumulando redund√¢ncias. Pare de comprar. Venda os que n√£o usa e reorganize.';
                }
            }

            // Encontrar fam√≠lias ausentes ou fracas
            const missing = Object.entries(families)
                .filter(([key, data]) => data.value === 0)
                .map(([key, data]) => ({ key, ...data }));
            
            const weak = Object.entries(families)
                .filter(([key, data]) => data.value === 1)
                .map(([key, data]) => ({ key, ...data }));

            // Gerar an√°lise
            const resultDiv = document.getElementById('result');
            const dominantDiv = document.getElementById('dominant-family');
            const adviceDiv = document.getElementById('balance-advice');
            const nextDiv = document.getElementById('next-purchase');

            // Contexto pessoal
            let contextoHTML = '';
            if (cidade) {
                let climaEmoji = climaRegiao === 'quente' ? 'üå°Ô∏è' : climaRegiao === 'frio' ? '‚ùÑÔ∏è' : 'üå§Ô∏è';
                contextoHTML += `<strong>Sua regi√£o:</strong> ${cidade} ${climaEmoji} (clima ${climaRegiao})<br>`;
            }
            if (custoMedio > 0) {
                let faixaOrcamento = '';
                let tipoCategoria = '';
                
                if (custoMedio <= 350) {
                    faixaOrcamento = 'econ√¥mica';
                    tipoCategoria = ' (nacionais, inspirados, √°rabes)';
                } else if (custoMedio > 350 && custoMedio < 1500) {
                    faixaOrcamento = 'intermedi√°ria';
                    tipoCategoria = ' (designers importados)';
                } else {
                    faixaOrcamento = 'premium';
                    tipoCategoria = ' (marcas de nicho)';
                }
                
                contextoHTML += `<strong>Custo m√©dio:</strong> R$ ${custoMedio} (faixa ${faixaOrcamento}${tipoCategoria})<br>`;
            }
            if (ambFechado || ambAberto || ambAmbos) {
                let ambientes = [];
                if (ambFechado) ambientes.push('Fechado');
                if (ambAberto) ambientes.push('Aberto');
                if (ambAmbos) ambientes.push('Ambos');
                contextoHTML += `<strong>Ambiente de trabalho:</strong> ${ambientes.join(', ')}<br>`;
            }

            dominantDiv.innerHTML = `
                <div style="background: rgba(212, 175, 55, 0.15); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #d4af37;">
                    <div style="font-size: 1.3em; margin-bottom: 10px;">${levelEmoji} <strong>SEU N√çVEL: ${level}</strong></div>
                    <div style="color: #ccc; font-size: 0.95em;">${levelAdvice}</div>
                </div>
                ${contextoHTML}
                <strong>Total de perfumes:</strong> ${total}<br>
                <strong>Fam√≠lias representadas:</strong> ${familiesRepresented}/6<br>
                <strong>Fam√≠lia dominante:</strong> ${dominant.name} (${maxValue} perfumes - ${percentage}%)
            `;

            // An√°lise e conselhos
            let advice = '';
            let status = '';

            if (percentage >= 50) {
                status = '‚ö†Ô∏è <strong>COLE√á√ÉO DESBALANCEADA</strong>';
                advice = `Voc√™ est√° viciado em ${dominant.name}. Isso cria redund√¢ncia ‚Äî voc√™ tem v√°rios perfumes fazendo a mesma fun√ß√£o. `;
                advice += `<br><br><strong>Problema:</strong> Quando voc√™ quer usar algo diferente, n√£o tem op√ß√£o real. Voc√™ sempre volta para a mesma zona de conforto.`;
            } else if (percentage >= 35) {
                status = '‚ö° <strong>COLE√á√ÉO COM VI√âS</strong>';
                advice = `${dominant.name} domina sua cole√ß√£o, mas ainda h√° variedade. Isso n√£o √© ruim se for intencional. `;
                advice += `<br><br><strong>Aten√ß√£o:</strong> Seu pr√≥ximo perfume N√ÉO deve ser dessa fam√≠lia, a menos que voc√™ tenha uma lacuna funcional real.`;
            } else {
                status = '‚úÖ <strong>COLE√á√ÉO EQUILIBRADA</strong>';
                advice = `Sua cole√ß√£o tem boa distribui√ß√£o entre fam√≠lias. Voc√™ tem op√ß√µes reais para diferentes contextos. `;
                advice += `Continue expandindo as fam√≠lias mais fracas antes de adicionar mais na dominante.`;
            }

            adviceDiv.innerHTML = status + '<br><br>' + advice;

            // RECOMENDA√á√ïES PERSONALIZADAS BASEADAS EM FAM√çLIAS FALTANTES
            let nextPurchase = '<strong>üéØ RECOMENDA√á√ïES PERSONALIZADAS:</strong><br><br>';
            
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += '<div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
                nextPurchase += '<strong>Fam√≠lias que voc√™ precisa adicionar:</strong><br><br>';
                
                // Recomenda√ß√µes espec√≠ficas para cada fam√≠lia faltante
                [...missing, ...weak].forEach(family => {
                    nextPurchase += `<div style="margin-bottom: 12px; padding-left: 10px; border-left: 3px solid #d4af37;">`;
                    nextPurchase += `<strong>${family.name}</strong><br>`;
                    
                    // Recomenda√ß√µes espec√≠ficas por fam√≠lia
                    if (family.key === 'fresco') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Essencial para calor e ver√£o. Ideal para: trabalho em ambiente aberto, dias quentes, p√≥s-treino.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: c√≠tricos limpos, √°gua de col√¥nia, bergamota + lavanda.</span>';
                    } else if (family.key === 'aromatico') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Vers√°til e profissional. Ideal para: trabalho em ambiente fechado, reuni√µes, uso di√°rio discreto.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: lavanda + s√°lvia, arom√°tico foug√®re, verde herbal.</span>';
                    } else if (family.key === 'doce') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Presen√ßa marcante. Ideal para: noite, encontros, frio, eventos sociais.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: baunilha + caramelo, tabaco doce, √¢mbar gourmand.</span>';
                    } else if (family.key === 'amadeirado') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Elegante e atemporal. Ideal para: trabalho formal, outono/inverno, assinatura masculina cl√°ssica.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: s√¢ndalo seco, cedro + vetiver, madeira nobre.</span>';
                    } else if (family.key === 'especiado') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Densidade e car√°ter. Ideal para: frio intenso, noite, quando quer impactar.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: canela + cravo, pimenta + incenso, especiaria oriental.</span>';
                    } else if (family.key === 'aquatico') {
                        nextPurchase += '<span style="color: #aaa;">‚Üí Frescor limpo e moderno. Ideal para: calor extremo, praia, esportes, ambiente casual.</span><br>';
                        nextPurchase += '<span style="color: #888; font-size: 0.9em;">Exemplos: √°gua marinha, oz√¥nico, mel√£o aqu√°tico.</span>';
                    }
                    
                    nextPurchase += `</div>`;
                });
                
                nextPurchase += '</div>';

                // Recomenda√ß√£o baseada em clima
                if (cidade) {
                    nextPurchase += '<div style="background: rgba(100, 150, 255, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
                    nextPurchase += '<strong>üìç Baseado no seu clima:</strong><br><br>';
                    
                    if (climaRegiao === 'quente') {
                        if (families.fresco.value === 0 || families.aquatico.value === 0) {
                            nextPurchase += 'üå°Ô∏è Voc√™ mora em regi√£o quente e N√ÉO tem Fresco/C√≠trico ou Aqu√°tico? Isso √© prioridade m√°xima.<br>';
                            nextPurchase += 'Sem eles, voc√™ vai sofrer no calor ou usar perfumes inadequados que sufocam.';
                        } else {
                            nextPurchase += '‚úÖ Voc√™ tem op√ß√µes para o calor da sua regi√£o. Continue mantendo essas fam√≠lias leves na rota√ß√£o.';
                        }
                    } else if (climaRegiao === 'frio') {
                        if (families.doce.value === 0 || families.especiado.value === 0) {
                            nextPurchase += '‚ùÑÔ∏è Voc√™ mora em regi√£o fria e N√ÉO tem Doce ou Especiado? Adicione urgente.<br>';
                            nextPurchase += 'Frescos e aqu√°ticos v√£o desaparecer no frio. Voc√™ precisa de densidade.';
                        } else {
                            nextPurchase += '‚úÖ Voc√™ tem op√ß√µes para o frio da sua regi√£o. Aproveite para usar os densos e especiados.';
                        }
                    } else {
                        nextPurchase += 'üå§Ô∏è Clima temperado exige versatilidade. Certifique-se de ter op√ß√µes para ambas as esta√ß√µes.';
                    }
                    
                    nextPurchase += '</div>';
                }

                // Recomenda√ß√£o baseada em ambiente de trabalho
                if (ambFechado || ambAberto || ambAmbos) {
                    nextPurchase += '<div style="background: rgba(100, 150, 255, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">';
                    nextPurchase += '<strong>üíº Baseado no seu trabalho:</strong><br><br>';
                    
                    if (ambFechado || ambAmbos) {
                        if (families.aromatico.value === 0) {
                            nextPurchase += 'üè¢ Ambiente fechado exige discretos! Arom√°tico/Verde √© ESSENCIAL para n√£o incomodar.<br>';
                            nextPurchase += 'Evite doces densos e √°rabes no escrit√≥rio ‚Äî voc√™ vai ser "aquele cara do perfume forte".';
                        } else {
                            nextPurchase += '‚úÖ Voc√™ tem op√ß√µes para ambiente fechado. Use arom√°ticos e amadeirados secos no trabalho.';
                        }
                    }
                    
                    if (ambAberto || ambAmbos) {
                        nextPurchase += '<br>üå≥ Ambiente aberto permite mais liberdade. Voc√™ pode usar perfumes com mais proje√ß√£o sem medo.';
                    }
                    
                    nextPurchase += '</div>';
                }
                
            } else {
                nextPurchase += 'Todas as fam√≠lias est√£o representadas. Escolha baseado em <strong>fun√ß√£o</strong> (calor, frio, trabalho, noite) que esteja faltando.';
            }

            // Pr√≥ximos passos baseados no n√≠vel
            if (level.includes('INICIANTE')) {
                nextPurchase += `<br>üéØ <strong>PR√ìXIMO PASSO:</strong> Complete as 5 fun√ß√µes b√°sicas antes de pensar em variedade de fam√≠lias.`;
            } else if (level.includes('redund√¢ncia') || level.includes('ac√∫mulo')) {
                nextPurchase += `<br>üõë <strong>PARE DE COMPRAR.</strong> Identifique perfumes redundantes, venda ou troque, e s√≥ compre quando identificar uma lacuna funcional real.`;
            }

            // Regra de ouro
            nextPurchase += `<br><br>üéØ <strong>REGRA DE OURO:</strong> Se voc√™ n√£o consegue pensar em 3 situa√ß√µes espec√≠ficas onde usaria o perfume que est√° pensando em comprar, voc√™ N√ÉO precisa dele.`;

            // SISTEMA DE RECOMENDA√á√ÉO DE 3 PERFUMES ESPEC√çFICOS
            if (missing.length > 0 || weak.length > 0) {
                nextPurchase += `<br><br><div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.05)); padding: 20px; border-radius: 10px; border: 2px solid #d4af37;">`;
                nextPurchase += `<div style="font-size: 1.2em; color: #d4af37; font-weight: 600; margin-bottom: 15px; text-align: center;">üéÅ 3 RECOMENDA√á√ïES PARA EQUILIBRAR SUA COLE√á√ÉO</div>`;
                nextPurchase += `<div style="color: #aaa; text-align: center; margin-bottom: 20px; font-size: 0.9em;">Baseado no seu clima, or√ßamento e lacunas identificadas</div>`;
                
                // Base de dados de perfumes por fam√≠lia e faixa de pre√ßo
                const perfumeDatabase = {
                    fresco: {
                        economico: [
                            { nome: "√Ågua de Cheiro Acqua Fresca", preco: "80-120", desc: "Nacional fresco c√≠trico para calor intenso" },
                            { nome: "Eudora Soul Fresh", preco: "100-150", desc: "Nacional aqu√°tico clean, dia a dia" },
                            { nome: "Lattitude Inspire (inspirado Invictus)", preco: "150-250", desc: "Inspirado fresco marinho, √≥tima performance" },
                            { nome: "Cheiro de Banho Brisas do Atl√¢ntico", preco: "120-180", desc: "Nacional aqu√°tico fresco, alta fixa√ß√£o" }
                        ],
                        intermediario: [
                            { nome: "Versace Pour Homme", preco: "280-380", desc: "C√≠trico elegante com notas aqu√°ticas" },
                            { nome: "Dolce & Gabbana Light Blue", preco: "350-480", desc: "C√≠trico sofisticado, muito vers√°til" },
                            { nome: "Acqua di Gi√≤ Profumo", preco: "400-550", desc: "Aqu√°tico denso, funciona ano todo" },
                            { nome: "Prada Luna Rossa Ocean", preco: "380-520", desc: "Aqu√°tico arom√°tico moderno" }
                        ],
                        premium: [
                            { nome: "Creed Aventus Cologne", preco: "1600-2200", desc: "Nicho fresco premium com performance excepcional" },
                            { nome: "Tom Ford Neroli Portofino", preco: "1800-2400", desc: "Nicho c√≠trico luxuoso, assinatura de ver√£o" },
                            { nome: "Parfums de Marly Percival", preco: "1500-2000", desc: "Nicho fresco amadeirado de alta qualidade" },
                            { nome: "Creed Silver Mountain Water", preco: "1600-2100", desc: "Nicho arom√°tico verde premium" }
                        ]
                    },
                    aromatico: {
                        economico: [
                            { nome: "Natura Homem Essence", preco: "120-180", desc: "Nacional arom√°tico discreto para trabalho" },
                            { nome: "O Botic√°rio Malbec Bleu", preco: "150-220", desc: "Nacional arom√°tico elegante, profissional" },
                            { nome: "Lattitude Route (inspirado Sauvage)", preco: "180-280", desc: "Inspirado arom√°tico pimenta, vers√°til" },
                            { nome: "Paris Elysees La Vie Est Belle Homme", preco: "100-150", desc: "Nacional arom√°tico limpo para dia a dia" }
                        ],
                        intermediario: [
                            { nome: "Dior Sauvage EDT", preco: "380-520", desc: "Arom√°tico pimenta, extremamente vers√°til" },
                            { nome: "Bleu de Chanel EDT", preco: "420-580", desc: "Arom√°tico c√≠trico sofisticado" },
                            { nome: "Prada L'Homme", preco: "350-480", desc: "Arom√°tico √≠ris clean para trabalho" },
                            { nome: "Versace Dylan Blue", preco: "300-420", desc: "Arom√°tico aqu√°tico moderno" }
                        ],
                        premium: [
                            { nome: "Tom Ford Grey Vetiver", preco: "1600-2200", desc: "Nicho arom√°tico elegante para trabalho formal" },
                            { nome: "Herm√®s Terre d'Herm√®s", preco: "1500-2000", desc: "Nicho arom√°tico c√≠trico atemporal" },
                            { nome: "Creed Green Irish Tweed", preco: "1700-2300", desc: "Nicho arom√°tico verde cl√°ssico" },
                            { nome: "Tom Ford Vert Boh√®me", preco: "2200-2800", desc: "Nicho arom√°tico verde premium" }
                        ]
                    },
                    doce: {
                        economico: [
                            { nome: "O Botic√°rio Malbec", preco: "120-180", desc: "Nacional doce amadeirado para noite" },
                            { nome: "Ferrari Black", preco: "150-220", desc: "Nacional doce especiado intenso" },
                            { nome: "Mahogany Leather Red (inspirado 1 Million)", preco: "180-280", desc: "Inspirado doce especiado noturno" },
                            { nome: "Afnan 9PM", preco: "200-320", desc: "√Årabe doce para noites frias, alta proje√ß√£o" }
                        ],
                        intermediario: [
                            { nome: "Paco Rabanne 1 Million", preco: "350-480", desc: "Doce especiado para noite" },
                            { nome: "Viktor & Rolf Spicebomb", preco: "400-550", desc: "Doce especiado intenso para frio" },
                            { nome: "Yves Saint Laurent La Nuit de L'Homme", preco: "380-520", desc: "Doce cardamomo elegante" },
                            { nome: "Jean Paul Gaultier Le Male Le Parfum", preco: "420-580", desc: "Doce oriental denso" }
                        ],
                        premium: [
                            { nome: "Initio Oud for Greatness", preco: "1800-2400", desc: "Nicho doce oud poderoso, presen√ßa m√°xima" },
                            { nome: "Parfums de Marly Layton", preco: "1600-2200", desc: "Nicho doce especiado de luxo" },
                            { nome: "Xerjoff Naxos", preco: "1700-2300", desc: "Nicho doce tabaco mel premium" },
                            { nome: "Tom Ford Tobacco Vanille", preco: "1800-2500", desc: "Nicho especiado tabaco baunilha ic√¥nico" }
                        ]
                    },
                    amadeirado: {
                        economico: [
                            { nome: "Natura Kaiak Tradicional", preco: "80-130", desc: "Nacional amadeirado cl√°ssico vers√°til" },
                            { nome: "O Botic√°rio Coffee Man", preco: "120-180", desc: "Nacional amadeirado caf√© elegante" },
                            { nome: "Lattitude Legend (inspirado Montblanc Legend)", preco: "180-280", desc: "Inspirado amadeirado discreto profissional" },
                            { nome: "Club de Nuit Intense Man", preco: "250-350", desc: "√Årabe amadeirado frutal (tipo Aventus)" }
                        ],
                        intermediario: [
                            { nome: "Bleu de Chanel Parfum", preco: "550-750", desc: "Amadeirado denso, assinatura premium" },
                            { nome: "Givenchy Gentleman EDP", preco: "400-550", desc: "Amadeirado √≠ris couro elegante" },
                            { nome: "Dior Homme Intense", preco: "450-600", desc: "Amadeirado √≠ris sofisticado" },
                            { nome: "Prada L'Homme Intense", preco: "380-520", desc: "Amadeirado √¢mbar discreto" }
                        ],
                        premium: [
                            { nome: "Creed Aventus", preco: "1800-2500", desc: "Nicho amadeirado frutal ic√¥nico" },
                            { nome: "Tom Ford Oud Wood", preco: "1800-2400", desc: "Nicho amadeirado oud acess√≠vel e elegante" },
                            { nome: "Parfums de Marly Herod", preco: "1600-2200", desc: "Nicho amadeirado tabaco canela premium" },
                            { nome: "Roja Dove Elysium", preco: "2200-3000", desc: "Nicho amadeirado c√≠trico de luxo absoluto" }
                        ]
                    },
                    especiado: {
                        economico: [
                            { nome: "Jequiti Make B. Boticollection", preco: "100-150", desc: "Nacional especiado doce para noite" },
                            { nome: "Eudora Glamour Secrets Black", preco: "120-180", desc: "Nacional especiado intenso noturno" },
                            { nome: "Rasasi La Yuqawam", preco: "200-320", desc: "√Årabe especiado tabaco para frio extremo" },
                            { nome: "Armaf Club de Nuit Intense", preco: "180-280", desc: "√Årabe especiado amadeirado potente" }
                        ],
                        intermediario: [
                            { nome: "Armani Code Profumo", preco: "400-550", desc: "Especiado doce para noites frias" },
                            { nome: "Dior Homme Parfum", preco: "500-700", desc: "Especiado √≠ris couro denso" },
                            { nome: "Azzaro Wanted by Night", preco: "350-480", desc: "Especiado canela intenso" },
                            { nome: "Giorgio Armani Stronger With You Intensely", preco: "380-520", desc: "Especiado doce moderno" }
                        ],
                        premium: [
                            { nome: "Initio Side Effect", preco: "1800-2400", desc: "Nicho especiado tabaco rum premium" },
                            { nome: "Parfums de Marly Oajan", preco: "1700-2300", desc: "Nicho especiado canela mel de luxo" },
                            { nome: "Amouage Interlude Man", preco: "1600-2200", desc: "Nicho especiado incenso complexo" },
                            { nome: "Roja Dove Enigma", preco: "2500-3500", desc: "Nicho especiado oriental absoluto" }
                        ]
                    },
                    aquatico: {
                        economico: [
                            { nome: "Natura Homem Verano", preco: "100-150", desc: "Nacional aqu√°tico para calor intenso" },
                            { nome: "Jequiti Oceano Atlantis", preco: "80-130", desc: "Nacional aqu√°tico fresco praia" },
                            { nome: "Paris Elysees Vodka Man", preco: "100-150", desc: "Nacional aqu√°tico clean para ver√£o" },
                            { nome: "Davidoff Cool Water", preco: "180-280", desc: "Aqu√°tico cl√°ssico para calor" }
                        ],
                        intermediario: [
                            { nome: "Acqua di Gi√≤ Profondo", preco: "400-550", desc: "Aqu√°tico marinho moderno" },
                            { nome: "Chanel Allure Homme Sport Eau Extr√™me", preco: "480-650", desc: "Aqu√°tico fresco esportivo premium" },
                            { nome: "Issey Miyake L'Eau d'Issey Pour Homme", preco: "350-480", desc: "Aqu√°tico yuzu elegante" },
                            { nome: "Bvlgari Aqva Pour Homme", preco: "380-520", desc: "Aqu√°tico marinho sofisticado" }
                        ],
                        premium: [
                            { nome: "Creed Virgin Island Water", preco: "1700-2300", desc: "Nicho aqu√°tico tropical premium" },
                            { nome: "Parfums de Marly Sedley", preco: "1600-2200", desc: "Nicho aqu√°tico bergamota elegante" },
                            { nome: "Acqua di Parma Blu Mediterraneo", preco: "1500-2000", desc: "Nicho aqu√°tico italiano luxuoso" },
                            { nome: "Creed Mill√©sime Imp√©rial", preco: "1800-2400", desc: "Nicho aqu√°tico frutal ic√¥nico" }
                        ]
                    }
                };

                // Determinar faixa de or√ßamento
                let faixaOrcamento = 'intermediario';
                if (custoMedio > 0) {
                    if (custoMedio <= 350) faixaOrcamento = 'economico';
                    else if (custoMedio > 350 && custoMedio < 1500) faixaOrcamento = 'intermediario';
                    else faixaOrcamento = 'premium';
                }

                // Priorizar fam√≠lias baseado em contexto
                let prioridades = [...missing, ...weak];
                
                // Ajustar prioridades baseado em clima
                if (climaRegiao === 'quente') {
                    prioridades = prioridades.sort((a, b) => {
                        const ordemCalor = ['fresco', 'aquatico', 'aromatico', 'amadeirado', 'doce', 'especiado'];
                        return ordemCalor.indexOf(a.key) - ordemCalor.indexOf(b.key);
                    });
                } else if (climaRegiao === 'frio') {
                    prioridades = prioridades.sort((a, b) => {
                        const ordemFrio = ['especiado', 'doce', 'amadeirado', 'aromatico', 'fresco', 'aquatico'];
                        return ordemFrio.indexOf(a.key) - ordemFrio.indexOf(b.key);
                    });
                }

                // Ajustar prioridades baseado em ambiente de trabalho
                if ((ambFechado || ambAmbos) && prioridades.some(p => p.key === 'aromatico')) {
                    prioridades = prioridades.sort((a, b) => {
                        if (a.key === 'aromatico') return -1;
                        if (b.key === 'aromatico') return 1;
                        return 0;
                    });
                }

                // Gerar 3 recomenda√ß√µes
                let recomendacoes = [];
                let familiasUsadas = new Set();

                for (let i = 0; i < Math.min(3, prioridades.length); i++) {
                    const familia = prioridades[i];
                    if (perfumeDatabase[familia.key] && !familiasUsadas.has(familia.key)) {
                        const opcoes = perfumeDatabase[familia.key][faixaOrcamento];
                        const perfume = opcoes[Math.floor(Math.random() * opcoes.length)];
                        recomendacoes.push({
                            familia: familia.name,
                            ...perfume,
                            prioridade: i + 1
                        });
                        familiasUsadas.add(familia.key);
                    }
                }

                // Exibir recomenda√ß√µes
                recomendacoes.forEach((rec, index) => {
                    let numeroBG = index === 0 ? '#d4af37' : index === 1 ? '#c4a037' : '#b49037';
                    nextPurchase += `
                        <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid ${numeroBG};">
                            <div style="display: flex; align-items: start; gap: 15px;">
                                <div style="background: ${numeroBG}; color: #000; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2em; flex-shrink: 0;">
                                    ${rec.prioridade}
                                </div>
                                <div style="flex: 1;">
                                    <div style="color: #d4af37; font-size: 1.1em; font-weight: 600; margin-bottom: 5px;">
                                        ${rec.nome}
                                    </div>
                                    <div style="color: #9bc4ff; font-size: 0.9em; margin-bottom: 5px;">
                                        ${rec.familia} ‚Ä¢ R$ ${rec.preco}
                                    </div>
                                    <div style="color: #ccc; font-size: 0.9em; line-height: 1.5;">
                                        ${rec.desc}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                nextPurchase += `<div style="color: #888; font-size: 0.85em; margin-top: 15px; text-align: center; font-style: italic;">
                    üí° Estas recomenda√ß√µes foram calculadas baseadas no seu clima, or√ßamento e fam√≠lias que faltam na sua cole√ß√£o.
                </div>`;
                
                nextPurchase += `</div>`;
            }

            // BOT√ÉO PARA O AGENTE GPT COM CONTEXTO
            const missingNames = [...missing, ...weak].map(f => f.name).join(', ');
            const ambienteTexto = [
                ambFechado ? 'fechado' : '',
                ambAberto ? 'aberto' : '',
                ambAmbos ? 'ambos' : ''
            ].filter(Boolean).join(', ');

            let diagnosticoCompleto = `Ol√°! Acabei de fazer meu diagn√≥stico de cole√ß√£o de perfumes e preciso de ajuda.\n\n`;
            diagnosticoCompleto += `üìä MEU PERFIL:\n`;
            diagnosticoCompleto += `‚Ä¢ Total de perfumes: ${total}\n`;
            diagnosticoCompleto += `‚Ä¢ N√≠vel: ${level}\n`;
            if (cidade) diagnosticoCompleto += `‚Ä¢ Cidade: ${cidade} (clima ${climaRegiao})\n`;
            if (custoMedio > 0) diagnosticoCompleto += `‚Ä¢ Or√ßamento m√©dio: R$ ${custoMedio}\n`;
            if (ambienteTexto) diagnosticoCompleto += `‚Ä¢ Ambiente de trabalho: ${ambienteTexto}\n`;
            diagnosticoCompleto += `\n`;
            diagnosticoCompleto += `üìâ AN√ÅLISE DA COLE√á√ÉO:\n`;
            diagnosticoCompleto += `‚Ä¢ Fam√≠lia dominante: ${dominant.name} (${percentage}%)\n`;
            diagnosticoCompleto += `‚Ä¢ Fam√≠lias que faltam ou est√£o fracas: ${missingNames || 'Nenhuma'}\n`;
            diagnosticoCompleto += `\n`;
            diagnosticoCompleto += `üéØ O QUE PRECISO:\n`;
            diagnosticoCompleto += `Recomenda√ß√µes personalizadas de perfumes dispon√≠veis no Brasil que equilibrem minha cole√ß√£o, considerando meu clima, or√ßamento e estilo de vida.`;

            // Guardar diagn√≥stico no localStorage para copiar
            localStorage.setItem('diagnostico_completo', diagnosticoCompleto);

            const gptLink = `https://chatgpt.com/g/g-68f7ee5b09248191b9b56f84210bf9ab-o-perfumista`;

            nextPurchase += `
                <div style="margin-top: 30px; text-align: center;">
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                        border: 3px solid #d4af37;
                        border-radius: 12px;
                        padding: 20px 25px;
                        margin-bottom: 20px;
                        color: #f4e5b1;
                        font-size: 1.05em;
                        font-weight: 700;
                        line-height: 1.6;
                        box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
                    ">
                        üí° Seu diagn√≥stico ser√° copiado automaticamente - cole no chat ao abrir o Agente
                    </div>
                    
                    <button onclick="copiarDiagnostico('${gptLink}')" style="
                        background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                        color: #1e1e1e;
                        border: none;
                        padding: 18px 40px;
                        border-radius: 12px;
                        font-size: 1.1em;
                        font-weight: 700;
                        cursor: pointer;
                        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
                        transition: all 0.3s ease;
                        display: inline-flex;
                        align-items: center;
                        gap: 10px;
                    " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(212, 175, 55, 0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.4)';">
                        <span style="font-size: 1.3em;">ü§ñ</span>
                        <span>Deseja op√ß√µes personalizadas com I.A.?</span>
                    </button>
                    
                    <div style="color: #888; font-size: 0.8em; margin-top: 10px;">
                        Voc√™ precisa estar logado na sua conta do ChatGPT
                    </div>
                </div>
            `;

            nextDiv.innerHTML = nextPurchase;

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Fun√ß√£o para copiar diagn√≥stico
        function copiarDiagnostico(gptLink) {
            const diagnostico = localStorage.getItem('diagnostico_completo');
            if (diagnostico) {
                navigator.clipboard.writeText(diagnostico).then(() => {
                    // Mostrar tutorial visual (N√ÉO abre o ChatGPT ainda)
                    mostrarTutorial(gptLink);
                }).catch(err => {
                    alert('N√£o foi poss√≠vel copiar automaticamente. Por favor, copie manualmente o diagn√≥stico acima.');
                });
            }
        }

        function mostrarTutorial(gptLink) {
            // Criar overlay
            const overlay = document.createElement('div');
            overlay.id = 'tutorial-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 2px solid #d4af37;
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 500px;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="text-align: center; color: #d4af37; font-size: 3em; margin-bottom: 20px;">
                        ‚úÖ
                    </div>
                    <div style="text-align: center; color: white; font-size: 1.5em; font-weight: 700; margin-bottom: 30px;">
                        Diagn√≥stico Copiado!
                    </div>
                    
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="color: #ccc; font-size: 1.05em; line-height: 2; text-align: left;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">1</span>
                                <span>Clique no bot√£o abaixo para abrir o ChatGPT</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">2</span>
                                <span>Cole seu diagn√≥stico com <strong style="color: #d4af37;">Ctrl+V</strong> (ou <strong style="color: #d4af37;">‚åò+V</strong> no Mac)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <span style="background: #d4af37; color: #000; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">3</span>
                                <span>Envie e receba recomenda√ß√µes personalizadas!</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; background: rgba(255, 100, 100, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #ff6b6b;">
                                <span style="background: #ff6b6b; color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; flex-shrink: 0;">‚ö†</span>
                                <span style="color: #ffb3b3;"><strong style="color: #ff6b6b;">IMPORTANTE:</strong> Voc√™ precisa estar logado no ChatGPT para utilizar o Agente.</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <a href="${gptLink}" target="_blank" style="text-decoration: none;">
                            <button onclick="fecharTutorial()" style="
                                background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                                color: #1e1e1e;
                                border: none;
                                padding: 15px 35px;
                                border-radius: 10px;
                                font-size: 1.1em;
                                font-weight: 700;
                                cursor: pointer;
                                box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                Abrir ChatGPT agora ‚Üí
                            </button>
                        </a>
                    </div>

                    <div style="text-align: center; color: #888; font-size: 0.85em; margin-top: 20px; cursor: pointer;" onclick="fecharTutorial()">
                        Fechar (ou pressione ESC)
                    </div>
                </div>
            `;

            // Adicionar estilos de anima√ß√£o
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            // Fechar com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') fecharTutorial();
            });
        }

        function fecharTutorial() {
            const overlay = document.getElementById('tutorial-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }

        // Salvar contadores
        ['fresco', 'aromatico', 'doce', 'amadeirado', 'especiado', 'aquatico'].forEach(id => {
            const input = document.getElementById(id);
            input.addEventListener('change', function() {
                localStorage.setItem(`count_${id}`, this.value);
            });
            
            const saved = localStorage.getItem(`count_${id}`);
            if (saved) {
                input.value = saved;
            }
        });

        // Salvar cidade
        const cidadeInput = document.getElementById('cidade');
        cidadeInput.addEventListener('change', function() {
            localStorage.setItem('cidade', this.value);
        });
        const savedCidade = localStorage.getItem('cidade');
        if (savedCidade) {
            cidadeInput.value = savedCidade;
        }

        // Salvar custo m√©dio
        const custoInput = document.getElementById('custo-medio');
        custoInput.addEventListener('change', function() {
            localStorage.setItem('custo-medio', this.value);
        });
        const savedCusto = localStorage.getItem('custo-medio');
        if (savedCusto) {
            custoInput.value = savedCusto;
        }

        // Salvar ambiente de trabalho
        ['amb-fechado', 'amb-aberto', 'amb-ambos'].forEach(id => {
            const checkbox = document.getElementById(id);
            checkbox.addEventListener('change', function() {
                localStorage.setItem(id, this.checked);
            });
            const saved = localStorage.getItem(id);
            if (saved === 'true') {
                checkbox.checked = true;
            }
        });

        // Anima√ß√£o ao entrar
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    </script>
</body>
</html>
